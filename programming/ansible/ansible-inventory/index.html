<!doctype html><html lang=en><head><title>Ansible Inventory :: Maksym Postument</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Second article in series about ansible. In this article, I will show how to use static and dynamic ansible inventory"><meta name=keywords content="VSCode,Devops,Ansible,pyenv,RedHat,Beginner,virtualenv,boto3"><meta name=robots content="noodp"><link rel=canonical href=https://mpostument.com/programming/ansible/ansible-inventory/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC",{anonymize_ip:!1})}</script><link rel=stylesheet href=https://mpostument.com/styles.css><link rel="shortcut icon" href=https://mpostument.com/img/theme-colors/blue.png><link rel=apple-touch-icon href=https://mpostument.com/img/theme-colors/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="mpostument.com"><meta name=twitter:creator content="Maks_Postument"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Ansible Inventory"><meta property="og:description" content="Second article in series about ansible. In this article, I will show how to use static and dynamic ansible inventory"><meta property="og:url" content="https://mpostument.com/programming/ansible/ansible-inventory/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:image" content="https://mpostument.com/ansible/ansible-inventory.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Devops"><meta property="article:section" content="Ansible"><meta property="article:section" content="Beginner"><meta property="article:published_time" content="2022-09-27 21:39:08 +0300 +0300"><p align=center style=background-color:#23b0ff>Sign up for my <a href=https://tinyletter.com/mpostument>email
newsletter</a> or use this <a href=/index.xml>RSS feed</a>. This is the best way to stay up-to-date with my latest content. Thank you for your continued support!</p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8633398301520801" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js></script>
<script src=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-js></script>
<script src=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-preset-algolia></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic><div id=autocomplete></div><script>var searchClient=algoliasearch("8HJOK7X4MI","a882cdf8954678175d442905d08d8926");const{autocomplete}=window["@algolia/autocomplete-js"],{getAlgoliaResults}=window["@algolia/autocomplete-preset-algolia"];autocomplete({container:"#autocomplete",placeholder:"Search",getSources({query:e}){return[{sourceId:"title",getItems(){return getAlgoliaResults({searchClient,queries:[{indexName:"mpostument",query:e,params:{hitsPerPage:5,attributesToSnippet:["title:15","description:35"],snippetEllipsisText:"…"}}]})},templates:{item({item:e,components:t,html:n}){return n`<div class="aa-ItemWrapper">
                            <div class="aa-ItemContent">
                              <div class="aa-ItemContentBody">
                                <div class="aa-ItemContentTitle">
                                  ${t.Highlight({hit:e,attribute:"title"})}
                                </div>
                                <div class="aa-ItemContentDescription">
                                  ${t.Snippet({hit:e,attribute:"description"})}
                                </div>
                              </div>
                            </div>
                          </div>`}},getItemUrl({item:e}){return e.href},onSelect({item:e}){window.location.href=e.href}}]}})</script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>mpostument.com</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/programming/>Programming</a></li><li><a href=/drawing/>Drawing</a></li><li><a href=/projects/>Projects</a></li><li><a href=/tags/>Tags</a></li><li><a href=/categories/>Categories</a></li><hr><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></li></ul><ul class="menu menu--desktop menu--language-selector"><li class=menu__trigger>English&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/programming/>Programming</a></li><li><a href=/drawing/>Drawing</a></li><li><a href=/projects/>Projects</a></li><li><a href=/tags/>Tags</a></li><li><a href=/categories/>Categories</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://mpostument.com/programming/ansible/ansible-inventory/>Ansible Inventory</a></h1><div class=post-meta><time class=post-date>2022-09-27 ::</time>
<span class=post-author>Maksym Postument</span>
<span class=post-reading-time>:: 4 min read (718 words)</span></div><span class=post-tags>#<a href=https://mpostument.com/tags/vscode/>VSCode</a>&nbsp;
#<a href=https://mpostument.com/tags/devops/>Devops</a>&nbsp;
#<a href=https://mpostument.com/tags/ansible/>Ansible</a>&nbsp;
#<a href=https://mpostument.com/tags/pyenv/>pyenv</a>&nbsp;
#<a href=https://mpostument.com/tags/redhat/>RedHat</a>&nbsp;
#<a href=https://mpostument.com/tags/beginner/>Beginner</a>&nbsp;</span>
<img src=https://mpostument.com/ansible/ansible-inventory.jpg class=post-cover alt="Ansible Inventory" title="Cover Image"><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#static-inventory>Static inventory</a></li><li><a href=#group-vars>Group Vars</a></li><li><a href=#dynamic-inventory>Dynamic Inventory</a></li><li><a href=#video>Video</a></li></ul></nav></div><div class=post-content><div><p><a href=https://mpostument.com/programming/ansible/manage-ansible-versions-with-pyenv/ title="Part 1 - Manage Ansible Versions With pyenv">Part 1 - Manage Ansible Versions With pyenv</a></p><p>Hello!</p><p>Today I will show you what inventory in Ansible and how to use them.</p><p>Ansible has two types of inventory - static and dynamic. Static is used when we know in advance the list of servers on which Ansible should run. And dynamic when we do not have this data in advance and we want to receive it dynamically.</p><h2 id=static-inventory>Static inventory<a href=#static-inventory class=hanchor arialabel=Anchor>&#8983;</a></h2><p>To use static inventory, it is enough to simply create a file, for example, <code>inventory</code>, and inside you can specify IP addresses, for example:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>192.168.1.1
</span></span></code></pre></div><p>This can be used immediately by specifying this file in the ansible command using <code>-i inventory all</code>. <code>all</code> means to run ansible on all servers from the inventory file.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ansible -m ping -i inventory all --private-key SSH_KEY --user SSH_USER
</span></span><span style=display:flex><span>192.168.1.1 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ping&#34;</span>: <span style=color:#e6db74>&#34;pong&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Servers can also be combined into groups.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>web<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>database<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.1
</span></span></code></pre></div><p>And now you can run ansible only for some group. To do this, you need to specify the name of the group instead of <code>all</code>. If you need to run for all servers, you can specify <code>all</code> again.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ansible -m ping -i inventory web --private-key SSH_KEY --user SSH_USER
</span></span><span style=display:flex><span>192.168.1.1 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ping&#34;</span>: <span style=color:#e6db74>&#34;pong&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>You can also specify a set of parameters for each server or group in the inventory. For example, the value that we passed using the &ndash;user key can be specified in the inventory.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>web<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.1 ansible_user<span style=color:#f92672>=</span>centos
</span></span></code></pre></div><p>Now the &ndash;user key can be omitted</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ansible -m ping -i inventory web --private-key SSH_KEY
</span></span><span style=display:flex><span>192.168.1.1 | SUCCESS <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ansible_facts&#34;</span>: <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;discovered_interpreter_python&#34;</span>: <span style=color:#e6db74>&#34;/usr/bin/python&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;changed&#34;</span>: false,
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;ping&#34;</span>: <span style=color:#e6db74>&#34;pong&#34;</span>
</span></span><span style=display:flex><span><span style=color:#f92672>}</span>
</span></span></code></pre></div><p>Also, parameters can be set at the group level, for this, you need to add another group with a name like[GROUP_NAME:vars]</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>web<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>web:vars<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>ansible_user<span style=color:#f92672>=</span>centos
</span></span></code></pre></div><p>The result will be the same as in the previous version, only now these parameters will be applied to this group.</p><p>Any values that will be used in playbooks in the future can be passed as parameters.</p><p>Also, several groups can be added to one group.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>web<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.1
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>db<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>192.168.1.2
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>webdb:children<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>web
</span></span><span style=display:flex><span>db
</span></span></code></pre></div><p>And if I specify -i inventory webdb when running ansible, ansible will run for all servers from those two groups.</p><h2 id=group-vars>Group Vars<a href=#group-vars class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Inventory is not the best place to store parameters. It is better to create a folder called group_vars and organize parameters for each group in it. The group can be organized as a folder or a file. In this example, I created a folder with a name that corresponds to the name of the group and inside a file that can have any name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>tree group_vars
</span></span><span style=display:flex><span>group_vars
</span></span><span style=display:flex><span>└── web
</span></span><span style=display:flex><span>    └── web
</span></span></code></pre></div><p>In file web now i can add variables which will be used for group web</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>ansible_user</span>: <span style=color:#ae81ff>centos</span>
</span></span></code></pre></div><p>And if I run ansible, I get the same result as last time.</p><h2 id=dynamic-inventory>Dynamic Inventory<a href=#dynamic-inventory class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Dynamic inventory is needed if we do not know the IP addresses in advance. For example, with AWS, where servers can often change and have different IP addresses. Dynamic inventory is a script that is passed to the -i parameter, and when this script is run, I will get all the necessary information about the servers. Some dynamic inventories have become part of ansible and do not need to be downloaded additionally, it is enough to simply indicate that it needs to be used.</p><p>To use AWS dynamic inventory, you need to install an additional python library called boto3. It can be installed using <code>pip install boto3</code>.</p><p>Since AWS dynamic inventory is part of ansible, no scripts need to be downloaded. But you need to create a configuration file aws_ec2.yml. The simplest one will look like this. And specify this file with -i key</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>plugin</span>: <span style=color:#ae81ff>aws_ec2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>regions</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>REGION</span>
</span></span><span style=display:flex><span><span style=color:#f92672>boto_profile</span>: <span style=color:#ae81ff>AWS_PROFILE</span>
</span></span></code></pre></div><p>In this case, ansible will be launched on all servers that are in this AWS account in the specified region. You can use filters to filter only the servers you want. For example, only servers that have the type = database tag.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span><span style=color:#f92672>plugin</span>: <span style=color:#ae81ff>aws_ec2</span>
</span></span><span style=display:flex><span><span style=color:#f92672>regions</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>REGION</span>
</span></span><span style=display:flex><span><span style=color:#f92672>boto_profile</span>: <span style=color:#ae81ff>AWS_PROFILE</span>
</span></span><span style=display:flex><span><span style=color:#f92672>filters</span>:
</span></span><span style=display:flex><span>  <span style=color:#f92672>tag:type</span>: <span style=color:#ae81ff>database</span>
</span></span></code></pre></div><p>Filters can be combined. All possible options can be found in the documentation of a specific dynamic plugin(<a href=https://docs.ansible.com/ansible/latest/collections/amazon/aws/aws_ec2_inventory.html#examples>AWS docs</a>).</p><h2 id=video>Video<a href=#video class=hanchor arialabel=Anchor>&#8983;</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/k74GIVucO_Y style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>