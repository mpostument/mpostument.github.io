<!doctype html><html lang=en><head><title>Docker Sdk Part One :: Maksym Postument</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="First article in series about docker SDK. In this article we will write docker pull and docker images commands with golang sdk"><meta name=keywords content="Go,Docker,Beginner,Golang"><meta name=robots content="noodp"><link rel=canonical href=https://mpostument.com/programming/golang/docker-sdk-part-one/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC",{anonymize_ip:!1})}</script><link rel=stylesheet href=https://mpostument.com/styles.css><link rel="shortcut icon" href=https://mpostument.com/img/theme-colors/blue.png><link rel=apple-touch-icon href=https://mpostument.com/img/theme-colors/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="mpostument.com"><meta name=twitter:creator content="Maks_Postument"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Docker Sdk Part One"><meta property="og:description" content="First article in series about docker SDK. In this article we will write docker pull and docker images commands with golang sdk"><meta property="og:url" content="https://mpostument.com/programming/golang/docker-sdk-part-one/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:image" content="https://i.imgur.com/aRPOd6p.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Golang"><meta property="article:section" content="Docker"><meta property="article:published_time" content="2022-03-22 20:31:29 +0200 +0200"><p align=center style=background-color:#23b0ff>Sign up for my <a href=https://tinyletter.com/mpostument>email
newsletter</a> or use this <a href=/index.xml>RSS feed</a>. This is the best way to stay up-to-date with my latest content. Thank you for your continued support!</p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8633398301520801" crossorigin=anonymous></script>
<script src=https://cdn.jsdelivr.net/npm/algoliasearch@4.14.2/dist/algoliasearch-lite.umd.js></script>
<script src=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-js></script>
<script src=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-preset-algolia></script>
<link rel=stylesheet href=https://cdn.jsdelivr.net/npm/@algolia/autocomplete-theme-classic><div id=autocomplete></div><script>var searchClient=algoliasearch("8HJOK7X4MI","a882cdf8954678175d442905d08d8926");const{autocomplete}=window["@algolia/autocomplete-js"],{getAlgoliaResults}=window["@algolia/autocomplete-preset-algolia"];autocomplete({container:"#autocomplete",placeholder:"Search",getSources({query:e}){return[{sourceId:"title",getItems(){return getAlgoliaResults({searchClient,queries:[{indexName:"mpostument",query:e,params:{hitsPerPage:5,attributesToSnippet:["title:15","description:35"],snippetEllipsisText:"…"}}]})},templates:{item({item:e,components:t,html:n}){return n`<div class="aa-ItemWrapper">
                            <div class="aa-ItemContent">
                              <div class="aa-ItemContentBody">
                                <div class="aa-ItemContentTitle">
                                  ${t.Highlight({hit:e,attribute:"title"})}
                                </div>
                                <div class="aa-ItemContentDescription">
                                  ${t.Snippet({hit:e,attribute:"description"})}
                                </div>
                              </div>
                            </div>
                          </div>`}},getItemUrl({item:e}){return e.href},onSelect({item:e}){window.location.href=e.href}}]}})</script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>mpostument.com</div></a></div><ul class="menu menu--mobile"><li class=menu__trigger>Menu&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=/>Home</a></li><li><a href=/programming/>Programming</a></li><li><a href=/drawing/>Drawing</a></li><li><a href=/guitar/>Guitar</a></li><li><a href=/projects/>Projects</a></li><li><a href=/tags/>Tags</a></li><li><a href=/categories/>Categories</a></li><hr><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></li></ul><ul class="menu menu--desktop menu--language-selector"><li class=menu__trigger>English&nbsp;▾</li><li><ul class=menu__dropdown><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></li></ul></div><nav class=navigation-menu><ul class="navigation-menu__inner menu--desktop"><li><a href=/>Home</a></li><li><a href=/programming/>Programming</a></li><li><a href=/drawing/>Drawing</a></li><li><a href=/guitar/>Guitar</a></li><li><a href=/projects/>Projects</a></li><li><a href=/tags/>Tags</a></li><li><a href=/categories/>Categories</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://mpostument.com/programming/golang/docker-sdk-part-one/>Docker Sdk Part One</a></h1><div class=post-meta><time class=post-date>2022-03-22 ::</time>
<span class=post-author>Maksym Postument</span>
<span class=post-reading-time>:: 3 min read (552 words)</span></div><span class=post-tags>#<a href=https://mpostument.com/tags/go/>Go</a>&nbsp;
#<a href=https://mpostument.com/tags/docker/>Docker</a>&nbsp;
#<a href=https://mpostument.com/tags/beginner/>Beginner</a>&nbsp;</span>
<img src=https://i.imgur.com/aRPOd6p.jpg class=post-cover alt="Docker Sdk Part One" title="Cover Image"><div class=post-content><div><p>Hi there!</p><p>This is the first part of the article about docker SDK. In the current article, we will see how with the help of golang it is possible to make pull and list docker images.</p><h2 id=docker-pull>Docker pull<a href=#docker-pull class=hanchor arialabel=Anchor>&#8983;</a></h2><p>As usual, initialize the go module, load the docker SDK and create the main.go file</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>go mod init
</span></span><span style=display:flex><span>go get github.com/docker/docker/client
</span></span></code></pre></div><p>Let&rsquo;s create a <code>PullImage</code> method in which we will create a docker client using the <code>client.NewClientWithOpts</code> method, as arguments to this method we will pass <code>client.FromEnv</code> which will take the docker configuration from environment variables and <code>client.WithAPIVersionNegotiation()</code> which will automatically determine the available version docker API. Now with the help of the client and the method <code>ImagePull</code> you can download the desired docker image. In the <code>ImagePull</code> method you need to pass the context, the name of the docker image that can be downloaded, and <code>types.ImagePullOptions{}</code>. In ImagePullOptions, you can pass authorization data if you need to download the docker image. At the very end, call <code>io.Copy(os.Stdout, out)</code> to display the pull command result. In the main function, call <code>PullImage</code> to load the docker image.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;io&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;os&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;log&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/api/types&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/client&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>PullImage</span>(<span style=color:#a6e22e>imageName</span> <span style=color:#66d9ef>string</span>) <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dockerClient</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>NewClientWithOpts</span>(<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>FromEnv</span>, <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>WithAPIVersionNegotiation</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>out</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dockerClient</span>.<span style=color:#a6e22e>ImagePull</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>imageName</span>, <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ImagePullOptions</span>{})
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>defer</span> <span style=color:#a6e22e>out</span>.<span style=color:#a6e22e>Close</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>io</span>.<span style=color:#a6e22e>Copy</span>(<span style=color:#a6e22e>os</span>.<span style=color:#a6e22e>Stdout</span>, <span style=color:#a6e22e>out</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>PullImage</span>(<span style=color:#e6db74>&#34;debian&#34;</span>)
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalln</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Running we will see the result</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;Pulling from library/debian&#34;</span>,<span style=color:#e6db74>&#34;id&#34;</span>:<span style=color:#e6db74>&#34;latest&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;Digest: sha256:b42494c466d101bf06038e959e2e5acd227e1251987e79528e7d8b1f4040deaf&#34;</span><span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span><span style=color:#e6db74>&#34;status&#34;</span>:<span style=color:#e6db74>&#34;Status: Image is up to date for debian:latest&#34;</span><span style=color:#f92672>}</span>
</span></span></code></pre></div><h2 id=docker-list>Docker list<a href=#docker-list class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Now let&rsquo;s write a method for displaying the docker images list. To do this, create the method <code>ListAllImages</code>. As in the previous example, create a docker client. Next, you need a filter that can be used to display the docker image according to some criteria. Since I want to display all docker images, the filter will remain empty. Now we will call a method <code>ImageList</code> in which it is necessary to pass a context and structure <code>ImageListOptions</code> which has two fields <code>All</code> and <code>Filters</code>. In <code>Filters</code> we will pass the previously created filter, and in <code>All</code> we will specify false. If you set <code>All</code> to true, then all intermediate docker images will also be displayed. You can now print information about all containers in the loop.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-go data-lang=go><span style=display:flex><span><span style=color:#f92672>package</span> <span style=color:#a6e22e>main</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#f92672>import</span> (
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;context&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;fmt&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/api/types&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/api/types/filters&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;github.com/docker/docker/client&#34;</span>
</span></span><span style=display:flex><span>)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>ListAllImages</span>() <span style=color:#66d9ef>error</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>ctx</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>context</span>.<span style=color:#a6e22e>Background</span>()
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>dockerClient</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>NewClientWithOpts</span>(<span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>FromEnv</span>, <span style=color:#a6e22e>client</span>.<span style=color:#a6e22e>WithAPIVersionNegotiation</span>())
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>filter</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>filters</span>.<span style=color:#a6e22e>NewArgs</span>()
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>images</span>, <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>dockerClient</span>.<span style=color:#a6e22e>ImageList</span>(<span style=color:#a6e22e>ctx</span>, <span style=color:#a6e22e>types</span>.<span style=color:#a6e22e>ImageListOptions</span>{
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>All</span>:     <span style=color:#66d9ef>false</span>,
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>Filters</span>: <span style=color:#a6e22e>filter</span>,
</span></span><span style=display:flex><span>    })
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#66d9ef>return</span> <span style=color:#a6e22e>err</span>
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>for</span> <span style=color:#a6e22e>_</span>, <span style=color:#a6e22e>i</span> <span style=color:#f92672>:=</span> <span style=color:#66d9ef>range</span> <span style=color:#a6e22e>images</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>fmt</span>.<span style=color:#a6e22e>Println</span>(<span style=color:#a6e22e>i</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>return</span> <span style=color:#66d9ef>nil</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#66d9ef>func</span> <span style=color:#a6e22e>main</span>() {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>err</span> <span style=color:#f92672>:=</span> <span style=color:#a6e22e>ListAllImages</span>()
</span></span><span style=display:flex><span>    <span style=color:#66d9ef>if</span> <span style=color:#a6e22e>err</span> <span style=color:#f92672>!=</span> <span style=color:#66d9ef>nil</span> {
</span></span><span style=display:flex><span>        <span style=color:#a6e22e>log</span>.<span style=color:#a6e22e>Fatalln</span>(<span style=color:#a6e22e>err</span>)
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>As a result, we will see:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>{</span>-1 <span style=color:#ae81ff>1623251330</span> sha256:c0a98e816f894adc33b1c39d87925a5979391bde533b38d6e6eb41326b904e65 map<span style=color:#f92672>[</span>maintainer:Sebastian Ramirez &lt;tiangolo@gmail.com&gt;<span style=color:#f92672>]</span>  <span style=color:#f92672>[</span>tiangolo/uvicorn-gunicorn-fastapi@sha256:f444216a887d0d4360edd5b69c78c1de530d0083a797176f9abf20f3f341b196<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>tiangolo/uvicorn-gunicorn-fastapi:python3.8<span style=color:#f92672>]</span> -1 <span style=color:#ae81ff>1014169179</span> 1014169179<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>-1 <span style=color:#ae81ff>1611933531</span> sha256:714c659c9f6f4a167fe294f9330387581007f1e86429d3460d1fc7bd7ee52ff7 map<span style=color:#f92672>[]</span>  <span style=color:#f92672>[</span>lambci/lambda@sha256:22e9fbb4df8270efcebed96905edf0244dd595a8d6250f24200ad558c0a201bc<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>lambci/lambda:build-python3.8<span style=color:#f92672>]</span> -1 <span style=color:#ae81ff>1962950336</span> 1962950336<span style=color:#f92672>}</span>
</span></span><span style=display:flex><span><span style=color:#f92672>{</span>-1 <span style=color:#ae81ff>1568356668</span> sha256:db427f282c433e8470846e3daddd3f666cfdbf85235ff66b3b6814d3840648f4 map<span style=color:#f92672>[]</span>  <span style=color:#f92672>[</span>selenoid/chrome@sha256:7be4763d02d4cd76c5081a4793485f9263ce4c25e56194b82567ecf597425f83<span style=color:#f92672>]</span> <span style=color:#f92672>[</span>selenoid/chrome:77.0<span style=color:#f92672>]</span> -1 <span style=color:#ae81ff>891512369</span> 891512369<span style=color:#f92672>}</span>
</span></span></code></pre></div><p>You can also display individual fields because the previous result is not easy to read. To do this in the loop, this call <code>fmt.Println(i)</code> can be replaced by <code>fmt.Println(i.RepoTags, i.Size)</code> and we get the following result:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span><span style=color:#f92672>[</span>tiangolo/uvicorn-gunicorn-fastapi:python3.8<span style=color:#f92672>]</span> <span style=color:#ae81ff>1014169179</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>lambci/lambda:build-python3.8<span style=color:#f92672>]</span> <span style=color:#ae81ff>1962950336</span>
</span></span><span style=display:flex><span><span style=color:#f92672>[</span>selenoid/chrome:77.0<span style=color:#f92672>]</span> <span style=color:#ae81ff>891512369</span>
</span></span></code></pre></div></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2023 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: <a href=https://github.com/panr/hugo-theme-terminal target=_blank>Theme</a> made by <a href=https://github.com/panr target=_blank>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>