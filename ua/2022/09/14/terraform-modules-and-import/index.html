<!doctype html><html lang=ua><head><title>Terraform Modules and Import :: Maksym Postument</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Ninth article in series about terraform. In this article i will show how to import existing resources in to state and create modules"><meta name=keywords content="VSCode,Devops,Terraform,HashiCorp,Beginner,EC2,Terraform Data,Data,Variables,lookups,condition,ternary operator"><meta name=robots content="noodp"><link rel=canonical href=https://mpostument.com/ua/2022/09/14/terraform-modules-and-import/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC",{anonymize_ip:!1})}</script><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=https://mpostument.com/img/theme-colors/blue.png><link rel=apple-touch-icon href=https://mpostument.com/img/theme-colors/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="mpostument.com"><meta name=twitter:creator content="Maks_Postument"><meta property="og:locale" content="ua"><meta property="og:type" content="article"><meta property="og:title" content="Terraform Modules and Import"><meta property="og:description" content="Ninth article in series about terraform. In this article i will show how to import existing resources in to state and create modules"><meta property="og:url" content="https://mpostument.com/ua/2022/09/14/terraform-modules-and-import/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:image" content="https://mpostument.com/terraform/terraform-modules-and-import.jpg"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Devops"><meta property="article:section" content="Terraform"><meta property="article:section" content="Beginner"><meta property="article:section" content="AWS"><meta property="article:published_time" content="2022-09-14 20:41:58 +0300 +0300"><p align=center style=background-color:#23b0ff>Sign up for my <a href=https://tinyletter.com/mpostument>email
newsletter</a> or use this <a href=/index.xml>RSS feed</a> to get notified of new blog posts.</p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8633398301520801" crossorigin=anonymous></script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/ua><div class=logo>mpostument.com</div></a></div><div class=menu-trigger>menu</div></div><nav class="menu hidden-on-mobile"><ul class="menu__inner menu__inner--desktop"><li><a href=/ua>Home</a></li><li><a href=/ua/categories/>Categories</a></li><li><a href=/ua/tags/>Tags</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>Ukraine ▾</li></ul><ul class="language-selector__more hidden"><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/ua>Home</a></li><li><a href=/ua/categories/>Categories</a></li><li><a href=/ua/tags/>Tags</a></li><hr><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://mpostument.com/ua/2022/09/14/terraform-modules-and-import/>Terraform Modules and Import</a></h1><div class=post-meta><time class=post-date>2022-09-14 ::</time>
<span class=post-author>Maksym Postument</span>
<span class=post-reading-time>:: 12 min read (2468 words)</span></div><span class=post-tags>#<a href=https://mpostument.com/ua/tags/vscode/>VSCode</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/devops/>Devops</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/terraform/>Terraform</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/tfenv/>tfenv</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/hashicorp/>HashiCorp</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/beginner/>Beginner</a>&nbsp;
#<a href=https://mpostument.com/ua/tags/aws/>AWS</a>&nbsp;</span>
<img src=https://mpostument.com/terraform/terraform-modules-and-import.jpg class=post-cover alt="Terraform Modules and Import" title="Cover Image"><div class=post-content><div><p><a href=https://mpostument.com/ua/2022/07/26/terraform-install/ title="Part 1 - Terraform Install">Part 1 - Terraform Install</a><br><a href=https://mpostument.com/ua/2022/07/28/terraform-basics/ title="Part 2 - Terraform Basics">Part 2 - Terraform Basics</a><br><a href=https://mpostument.com/ua/2022/07/31/terraform-state/ title="Part 3 - Terraform State">Part 3 - Terraform State</a><br><a href=https://mpostument.com/ua/2022/08/11/terraform-template/ title="Part 4 - Terraform Template">Part 4 - Terraform Template</a><br><a href=https://mpostument.com/ua/2022/08/22/terraform-dynamic/ title="Part 5 - Terraform Dynamic">Part 5 - Terraform Dynamic</a><br><a href=https://mpostument.com/ua/2022/08/28/terraform-lifecycle/ title="Part 6 - Terraform Lifecycle">Part 6 - Terraform Lifecycle</a><br><a href=https://mpostument.com/ua/2022/09/09/terraform-variables/ title="Part 7 - Terraform Variables">Part 7 - Terraform Lifecycle</a><br><a href=https://mpostument.com/ua/2022/09/11/terraform-condition-and-lookup/ title="Part 8 - Terraform Condition and Lookup">Part 8 - Terraform Condition and Lookup</a></p><p>Привіт!</p><p>Сьогодні подивимось як можна імпортувати існуючі ресурси в terraform і як організувати код в модуль для зручного перевикористання.</p><h2 id=import>Import<a href=#import class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Буває ситуація коли ресурси вже створенні і ними потрібно почати управляти за допомогою terraform. Або ж ресурс був видалений з terraform state і потрібно його знову туди додати. Це дуже просто за допомогою <code>terraform import</code>.</p><p>Є код який створює ec2 сервер, але сервер вже існує</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;foo&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami</span>                    = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>amzn</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>          = var.<span style=color:#a6e22e>instance_type</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>              = <span style=color:#e6db74>&#34;subnet-db73f0ac&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_security_group_ids</span> = [<span style=color:#e6db74>&#34;sg-b04b8cd4&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Env</span> = <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>volume_tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Env&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Якщо запустити terraform то сервер буде створено ще один раз</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ terraform plan
</span></span><span style=display:flex><span>data.aws_ami.amzn: Reading...
</span></span><span style=display:flex><span>data.aws_ami.amzn: Read complete after 0s <span style=color:#f92672>[</span>id<span style=color:#f92672>=</span>ami-05fa00d4c63e32376<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
</span></span><span style=display:flex><span>  + create
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform will perform the following actions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># aws_instance.foo will be created</span>
</span></span><span style=display:flex><span>  + resource <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;foo&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      + ami                                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ami-05fa00d4c63e32376&#34;</span>
</span></span><span style=display:flex><span>      + arn                                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + associate_public_ip_address          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + availability_zone                    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + cpu_core_count                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + cpu_threads_per_core                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + disable_api_stop                     <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + disable_api_termination              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + ebs_optimized                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + get_password_data                    <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>      + host_id                              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + id                                   <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_initiated_shutdown_behavior <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_state                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_type                        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;c5.large&#34;</span>
</span></span><span style=display:flex><span>      + ipv6_address_count                   <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + ipv6_addresses                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + key_name                             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + monitoring                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + outpost_arn                          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + password_data                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + placement_group                      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + placement_partition_number           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + primary_network_interface_id         <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + private_dns                          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + private_ip                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + public_dns                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + public_ip                            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + secondary_private_ips                <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + security_groups                      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + source_dest_check                    <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>      + subnet_id                            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;subnet-db73f0ac&#34;</span>
</span></span><span style=display:flex><span>      + tags                                 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;Env&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      + tags_all                             <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;Env&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      + tenancy                              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data                            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data_base64                     <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data_replace_on_change          <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>      + volume_tags                          <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;Env&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      + vpc_security_group_ids               <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;sg-b04b8cd4&#34;</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + capacity_reservation_specification <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + capacity_reservation_preference <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          + capacity_reservation_target <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              + capacity_reservation_id                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              + capacity_reservation_resource_group_arn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + ebs_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_name           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + encrypted             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + iops                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + kms_key_id            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + snapshot_id           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + tags                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + throughput            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_id             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_size           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_type           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + enclave_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + enabled <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + ephemeral_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + device_name  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + no_device    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + virtual_name <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + maintenance_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + auto_recovery <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + metadata_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + http_endpoint               <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + http_put_response_hop_limit <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + http_tokens                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + instance_metadata_tags      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + network_interface <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_index          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + network_card_index    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + network_interface_id  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + private_dns_name_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + enable_resource_name_dns_a_record    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + enable_resource_name_dns_aaaa_record <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + hostname_type                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + root_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_name           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + encrypted             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + iops                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + kms_key_id            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + tags                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + throughput            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_id             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_size           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_type           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Plan: <span style=color:#ae81ff>1</span> to add, <span style=color:#ae81ff>0</span> to change, <span style=color:#ae81ff>0</span> to destroy.
</span></span></code></pre></div><p>Для того щоб імпортувати вже створений сервер в terraform потрібно запустити <code>terraform import tf_resource.resource_name existing_resource_id</code>. Оскільки я хочу імпортувати aws_instance з назвою foo кий має id i-0ea46560d61c09724 то команда буде виглядати так <code>terraform import aws_instance.foo i-0ea46560d61c09724</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ terraform import aws_instance.foo i-0ea46560d61c09724
</span></span><span style=display:flex><span>aws_instance.foo: Importing from ID <span style=color:#e6db74>&#34;i-0ea46560d61c09724&#34;</span>...
</span></span><span style=display:flex><span>aws_instance.foo: Import prepared!
</span></span><span style=display:flex><span>  Prepared aws_instance <span style=color:#66d9ef>for</span> import
</span></span><span style=display:flex><span>aws_instance.foo: Refreshing state... <span style=color:#f92672>[</span>id<span style=color:#f92672>=</span>i-0ea46560d61c09724<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Import successful!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>The resources that were imported are shown above. These resources are now in
</span></span><span style=display:flex><span>your Terraform state and will henceforth be managed by Terraform.
</span></span></code></pre></div><p>Якщо знову запустити <code>terraform plan</code> то результат буде інший.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ terraform plan
</span></span><span style=display:flex><span>data.aws_ami.amzn: Reading...
</span></span><span style=display:flex><span>data.aws_ami.amzn: Read complete after 0s <span style=color:#f92672>[</span>id<span style=color:#f92672>=</span>ami-05fa00d4c63e32376<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>aws_instance.foo: Refreshing state... <span style=color:#f92672>[</span>id<span style=color:#f92672>=</span>i-0ea46560d61c09724<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>No changes. Your infrastructure matches the configuration.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform has compared your real infrastructure against your configuration and found no differences, so no changes are needed.
</span></span></code></pre></div><h2 id=modules>Modules<a href=#modules class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Модуль дозволяє об&rsquo;єднати декілька terraform ресурсів в одну абстракцію для зручного повторного використання. Візьму код з одного з попередніх постів який створює сервер так security group. І припустимо що потрібно створити ще 5 схожих серверів та security group. Звичайно може 5 раз скопіювати цей код і поміняти значення параметрів, а можна його параметризувати то створити модуль.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;foo&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami</span>                    = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>amzn</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>          = var.<span style=color:#a6e22e>instance_type</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>              = <span style=color:#e6db74>&#34;subnet-db73f0ac&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_security_group_ids</span> = [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>test_sg</span>.<span style=color:#a6e22e>id</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Env</span> = <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>volume_tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#e6db74>&#34;Env&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;Dev&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;test_sg&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;test-sg&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;allow traffic to web app&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = <span style=color:#e6db74>&#34;vcp-123&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dynamic</span> <span style=color:#e6db74>&#34;ingress&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>for_each</span> = [<span style=color:#ae81ff>8080</span>, <span style=color:#ae81ff>443</span>, <span style=color:#ae81ff>22</span>, <span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>3000</span>, <span style=color:#ae81ff>8082</span>]
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from_port</span> = <span style=color:#a6e22e>ingress</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to_port</span>   = <span style=color:#a6e22e>ingress</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>protocol</span>  = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cidr_blocks</span> = [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Для початку потрібно максимально параметризувати. Для security_group я створю два параметри vpc i інша зі списком портів які мають бути відкриті. Для сервера буде чотири параметри це ami, subnet, instance_type i security group. І один загальний параметр який буде називатись prefix. він потрібен для того щоб створювати різні назви для ресурсів, а можна і просто зробити параметр name який буде задавати для всього назву</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;instance_type&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>default</span>     = <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Instance type for test instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;subnet_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Subnet id where server will be created&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;security_groups&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;List of sg for instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = list(<span style=color:#a6e22e>string</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;ports_list&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;List of port which should be open&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = list(<span style=color:#a6e22e>number</span>)
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;ami_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Id of ami which should be used for instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;vpc_id&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Id of vpc where sg will be created&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>variable</span> <span style=color:#e6db74>&#34;prefix&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;Prefix to be added to all created resources&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>type</span>        = <span style=color:#a6e22e>string</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>І в самому коді вкажемо використовувати ці параметри</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;foo&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami</span>                    = var.<span style=color:#a6e22e>ami_id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>          = var.<span style=color:#a6e22e>instance_type</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>              = var.<span style=color:#a6e22e>subnet_id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_security_group_ids</span> = concat(var.<span style=color:#a6e22e>security_groups</span>, [<span style=color:#a6e22e>aws_security_group</span>.<span style=color:#a6e22e>test_sg</span>.<span style=color:#a6e22e>id</span>])
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>tags</span> = {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>Name</span> = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-common-instance&#34;</span>
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>resource</span> <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;test_sg&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>name</span>        = <span style=color:#e6db74>&#34;</span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-common-sg&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>description</span> = <span style=color:#e6db74>&#34;allow traffic to </span><span style=color:#e6db74>${</span>var.<span style=color:#a6e22e>prefix</span><span style=color:#e6db74>}</span><span style=color:#e6db74>-common-instance&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>      = var.<span style=color:#a6e22e>vpc_id</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>dynamic</span> <span style=color:#e6db74>&#34;ingress&#34;</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>for_each</span> = var.<span style=color:#a6e22e>ports_list</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>content</span> {
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>from_port</span> = <span style=color:#a6e22e>ingress</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>to_port</span>   = <span style=color:#a6e22e>ingress</span>.<span style=color:#a6e22e>value</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>protocol</span>  = <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>      <span style=color:#a6e22e>cidr_blocks</span> = [
</span></span><span style=display:flex><span>        <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>
</span></span><span style=display:flex><span>      ]
</span></span><span style=display:flex><span>    }
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>egress</span> {
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>from_port</span>   = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>to_port</span>     = <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>protocol</span>    = <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#a6e22e>cidr_blocks</span> = [<span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>]
</span></span><span style=display:flex><span>  }
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Тепер що залишилось це перенести це в окрему теку і використати як модуль. Я створю теку modules в які створю ще одну common_server в яку переміщу створений код.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree modules
</span></span><span style=display:flex><span>modules
</span></span><span style=display:flex><span>└── common_server
</span></span><span style=display:flex><span>    ├── main.tf
</span></span><span style=display:flex><span>    └── variables.tf
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>1</span> directory, <span style=color:#ae81ff>2</span> files
</span></span></code></pre></div><p>Тепер я можу створити новий terraform файл(main.tf) і вказати використовувати модуль</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;common_server&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>source</span>          = <span style=color:#e6db74>&#34;./modules/common_server&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami_id</span>          = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>amzn</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> = [<span style=color:#e6db74>&#34;sg-b04b8cd4&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>          = <span style=color:#e6db74>&#34;vpc-e5543380&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>       = <span style=color:#e6db74>&#34;subnet-5f70bf74&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ports_list</span>      = [<span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>443</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prefix</span>          = <span style=color:#e6db74>&#34;maksym&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>   = <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Якщо я одразу запущу terraform то отримаю помилку</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ terraform plan
</span></span><span style=display:flex><span>╷
</span></span><span style=display:flex><span>│ Error: Module not installed
</span></span><span style=display:flex><span>│ 
</span></span><span style=display:flex><span>│   on main.tf line 1:
</span></span><span style=display:flex><span>│    1: module <span style=color:#e6db74>&#34;common_server&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>│ 
</span></span><span style=display:flex><span>│ This module is not yet installed. Run <span style=color:#e6db74>&#34;terraform init&#34;</span> to install all modules required by this configuration.
</span></span></code></pre></div><p>Спочатку потрібно запустити <code>terraform init</code> щоб ініціалізувати модуль.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ terraform init
</span></span><span style=display:flex><span>Initializing modules...
</span></span><span style=display:flex><span>- common_server in modules/common_server
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Initializing the backend...
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Initializing provider plugins...
</span></span><span style=display:flex><span>- Reusing previous version of hashicorp/aws from the dependency lock file
</span></span><span style=display:flex><span>- Using previously-installed hashicorp/aws v4.23.0
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform has made some changes to the provider dependency selections recorded
</span></span><span style=display:flex><span>in the .terraform.lock.hcl file. Review those changes and commit them to your
</span></span><span style=display:flex><span>version control system <span style=color:#66d9ef>if</span> they represent changes you intended to make.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform has been successfully initialized!
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>You may now begin working with Terraform. Try running <span style=color:#e6db74>&#34;terraform plan&#34;</span> to see
</span></span><span style=display:flex><span>any changes that are required <span style=color:#66d9ef>for</span> your infrastructure. All Terraform commands
</span></span><span style=display:flex><span>should now work.
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>If you ever set or change modules or backend configuration <span style=color:#66d9ef>for</span> Terraform,
</span></span><span style=display:flex><span>rerun this command to reinitialize your working directory. If you forget, other
</span></span><span style=display:flex><span>commands will detect it and remind you to <span style=color:#66d9ef>do</span> so <span style=color:#66d9ef>if</span> necessary.
</span></span></code></pre></div><p>Після цього можна запустити <code>terraform plan</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>terraform plan
</span></span><span style=display:flex><span>data.aws_ami.amzn: Reading...
</span></span><span style=display:flex><span>data.aws_ami.amzn: Read complete after 1s <span style=color:#f92672>[</span>id<span style=color:#f92672>=</span>ami-05fa00d4c63e32376<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform used the selected providers to generate the following execution plan. Resource actions are indicated with the following symbols:
</span></span><span style=display:flex><span>  + create
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Terraform will perform the following actions:
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># module.common_server.aws_instance.foo will be created</span>
</span></span><span style=display:flex><span>  + resource <span style=color:#e6db74>&#34;aws_instance&#34;</span> <span style=color:#e6db74>&#34;foo&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      + ami                                  <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;ami-05fa00d4c63e32376&#34;</span>
</span></span><span style=display:flex><span>      + arn                                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + associate_public_ip_address          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + availability_zone                    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + cpu_core_count                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + cpu_threads_per_core                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + disable_api_stop                     <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + disable_api_termination              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + ebs_optimized                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + get_password_data                    <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>      + host_id                              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + id                                   <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_initiated_shutdown_behavior <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_state                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + instance_type                        <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>      + ipv6_address_count                   <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + ipv6_addresses                       <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + key_name                             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + monitoring                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + outpost_arn                          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + password_data                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + placement_group                      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + placement_partition_number           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + primary_network_interface_id         <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + private_dns                          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + private_ip                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + public_dns                           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + public_ip                            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + secondary_private_ips                <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + security_groups                      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + source_dest_check                    <span style=color:#f92672>=</span> true
</span></span><span style=display:flex><span>      + subnet_id                            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;subnet-5f70bf74&#34;</span>
</span></span><span style=display:flex><span>      + tags                                 <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;maksym-common-instance&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      + tags_all                             <span style=color:#f92672>=</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + <span style=color:#e6db74>&#34;Name&#34;</span> <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;maksym-common-instance&#34;</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>      + tenancy                              <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data                            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data_base64                     <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + user_data_replace_on_change          <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>      + vpc_security_group_ids               <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + capacity_reservation_specification <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + capacity_reservation_preference <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>          + capacity_reservation_target <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              + capacity_reservation_id                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>              + capacity_reservation_resource_group_arn <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + ebs_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_name           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + encrypted             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + iops                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + kms_key_id            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + snapshot_id           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + tags                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + throughput            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_id             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_size           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_type           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + enclave_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + enabled <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + ephemeral_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + device_name  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + no_device    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + virtual_name <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + maintenance_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + auto_recovery <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + metadata_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + http_endpoint               <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + http_put_response_hop_limit <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + http_tokens                 <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + instance_metadata_tags      <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + network_interface <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_index          <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + network_card_index    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + network_interface_id  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + private_dns_name_options <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + enable_resource_name_dns_a_record    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + enable_resource_name_dns_aaaa_record <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + hostname_type                        <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>      + root_block_device <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>          + delete_on_termination <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + device_name           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + encrypted             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + iops                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + kms_key_id            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + tags                  <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + throughput            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_id             <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_size           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>          + volume_type           <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>        <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#75715e># module.common_server.aws_security_group.test_sg will be created</span>
</span></span><span style=display:flex><span>  + resource <span style=color:#e6db74>&#34;aws_security_group&#34;</span> <span style=color:#e6db74>&#34;test_sg&#34;</span> <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>      + arn                    <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + description            <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;allow traffic to maksym-common-instance&#34;</span>
</span></span><span style=display:flex><span>      + egress                 <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          + <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              + cidr_blocks      <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                  + <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>              + description      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>              + from_port        <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>              + ipv6_cidr_blocks <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + prefix_list_ids  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + protocol         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;-1&#34;</span>
</span></span><span style=display:flex><span>              + security_groups  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + self             <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>              + to_port          <span style=color:#f92672>=</span> <span style=color:#ae81ff>0</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      + id                     <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + ingress                <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>          + <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              + cidr_blocks      <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                  + <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>              + description      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>              + from_port        <span style=color:#f92672>=</span> <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>              + ipv6_cidr_blocks <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + prefix_list_ids  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + protocol         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>              + security_groups  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + self             <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>              + to_port          <span style=color:#f92672>=</span> <span style=color:#ae81ff>443</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>          + <span style=color:#f92672>{</span>
</span></span><span style=display:flex><span>              + cidr_blocks      <span style=color:#f92672>=</span> <span style=color:#f92672>[</span>
</span></span><span style=display:flex><span>                  + <span style=color:#e6db74>&#34;0.0.0.0/0&#34;</span>,
</span></span><span style=display:flex><span>                <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>              + description      <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;&#34;</span>
</span></span><span style=display:flex><span>              + from_port        <span style=color:#f92672>=</span> <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>              + ipv6_cidr_blocks <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + prefix_list_ids  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + protocol         <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;tcp&#34;</span>
</span></span><span style=display:flex><span>              + security_groups  <span style=color:#f92672>=</span> <span style=color:#f92672>[]</span>
</span></span><span style=display:flex><span>              + self             <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>              + to_port          <span style=color:#f92672>=</span> <span style=color:#ae81ff>80</span>
</span></span><span style=display:flex><span>            <span style=color:#f92672>}</span>,
</span></span><span style=display:flex><span>        <span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>      + name                   <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;maksym-common-sg&#34;</span>
</span></span><span style=display:flex><span>      + name_prefix            <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + owner_id               <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + revoke_rules_on_delete <span style=color:#f92672>=</span> false
</span></span><span style=display:flex><span>      + tags_all               <span style=color:#f92672>=</span> <span style=color:#f92672>(</span>known after apply<span style=color:#f92672>)</span>
</span></span><span style=display:flex><span>      + vpc_id                 <span style=color:#f92672>=</span> <span style=color:#e6db74>&#34;vpc-e5543380&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>}</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>Plan: <span style=color:#ae81ff>2</span> to add, <span style=color:#ae81ff>0</span> to change, <span style=color:#ae81ff>0</span> to destroy.
</span></span></code></pre></div><p>Тепер щоб створити декілька версії серверів потрібно просто скопіювати виклик модуля і змінити параметри.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-terraform data-lang=terraform><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;common_server&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>source</span>          = <span style=color:#e6db74>&#34;./modules/common_server&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami_id</span>          = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>amzn</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> = [<span style=color:#e6db74>&#34;sg-b04b8cd4&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>          = <span style=color:#e6db74>&#34;vpc-e5543380&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>       = <span style=color:#e6db74>&#34;subnet-5f70bf74&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ports_list</span>      = [<span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>443</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prefix</span>          = <span style=color:#e6db74>&#34;maksym&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>   = <span style=color:#e6db74>&#34;t2.micro&#34;</span>
</span></span><span style=display:flex><span>}
</span></span><span style=display:flex><span><span style=color:#66d9ef>
</span></span></span><span style=display:flex><span><span style=color:#66d9ef>module</span> <span style=color:#e6db74>&#34;appserver&#34;</span> {
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>source</span>          = <span style=color:#e6db74>&#34;./modules/common_server&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ami_id</span>          = data.<span style=color:#a6e22e>aws_ami</span>.<span style=color:#a6e22e>amzn</span>.<span style=color:#a6e22e>id</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>security_groups</span> = [<span style=color:#e6db74>&#34;sg-b04a9dc5&#34;</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>vpc_id</span>          = <span style=color:#e6db74>&#34;vpc-e5543380&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>subnet_id</span>       = <span style=color:#e6db74>&#34;subnet-5f70bf74&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>ports_list</span>      = [<span style=color:#ae81ff>80</span>, <span style=color:#ae81ff>443</span>, <span style=color:#ae81ff>9090</span>, <span style=color:#ae81ff>8888</span>]
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>prefix</span>          = <span style=color:#e6db74>&#34;app&#34;</span>
</span></span><span style=display:flex><span>  <span style=color:#a6e22e>instance_type</span>   = <span style=color:#e6db74>&#34;m5.large&#34;</span>
</span></span><span style=display:flex><span>}
</span></span></code></pre></div><p>Модуль не обов&rsquo;язково має знаходить на файловій системі щоб його використовувати, як source можна вказати і посилання на source control як github чи на <a href=https://registry.terraform.io/>terraform registry</a> і модуль буде автоматично завантажено.</p><h2 id=modules-import>Modules import<a href=#modules-import class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Тепер якщо спробувати імпортувати ресурс так як ми робили на початку не вийде тому що тепер ресурси мають інші назви. Наприклад aws_instance до модуля відображався як <code>aws_instance.foo</code> тепер ж нове посилання буде <code>module.common_server.aws_instance.foo</code>. Відповідно щоб імпортувати цей самий сервер що спочатку команда буде виглядати як <code>terraform import module.common_server.aws_instance.foo i-0ea46560d61c09724</code>.</p><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/uCapjyzxJBo style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mpostument.com/ua/2022/09/19/manage-ansible-versions-with-pyenv/><span class=button__icon>←</span>
<span class=button__text>Manage Ansible Versions With pyenv</span></a></span>
<span class="button next"><a href=https://mpostument.com/ua/2022/09/11/terraform-condition-and-lookup/><span class=button__text>Terraform Condition and Lookup</span>
<span class=button__icon>→</span></a></span></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>