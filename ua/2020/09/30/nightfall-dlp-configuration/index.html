<!doctype html><html lang=ua><head><title>Nightfall Dlp Configuration :: mpostument.com</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Привіт!
Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.
Github Action Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу. Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.
name: nightfalldlp on: push: branches: - master pull_request: jobs: run-nightfalldlp: name: nightfalldlp runs-on: ubuntu-latest steps: - name: Checkout Repo Action uses: actions/checkout@v2 - name: nightfallDLP action step uses: nightfallai/nightfall_dlp_action@v0."><meta name=keywords content="Devops,AWS,Golang,Sharp"><meta name=robots content="noodp"><link rel=canonical href=/ua/2020/09/30/nightfall-dlp-configuration/><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176839804-1','auto');ga('send','pageview');}</script><link rel=stylesheet href=/assets/style.css><link rel=apple-touch-icon href=/img/apple-touch-icon-192x192.png><link rel="shortcut icon" href=/img/favicon/orange.png><meta name=twitter:card content="summary"><meta name=twitter:site content="mpostument.com"><meta name=twitter:creator content="Maks_Postument"><meta property="og:locale" content="ua"><meta property="og:type" content="article"><meta property="og:title" content="Nightfall Dlp Configuration"><meta property="og:description" content="Привіт!
Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.
Github Action Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу. Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.
name: nightfalldlp on: push: branches: - master pull_request: jobs: run-nightfalldlp: name: nightfalldlp runs-on: ubuntu-latest steps: - name: Checkout Repo Action uses: actions/checkout@v2 - name: nightfallDLP action step uses: nightfallai/nightfall_dlp_action@v0."><meta property="og:url" content="/ua/2020/09/30/nightfall-dlp-configuration/"><meta property="og:site_name" content="mpostument.com"><meta property="og:image" content="https://i.imgur.com/j2fDweo.jpg"><meta property="og:image:width" content="2048"><meta property="og:image:height" content="1024"><meta property="article:section" content="Devops"><meta property="article:published_time" content="2020-09-30 21:52:21 +0300 +0300"></head><body class=orange><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/ua><div class=logo>mpostument.com</div></a></div><div class=menu-trigger>menu</div></div><nav class=menu><ul class="menu__inner menu__inner--desktop"><li><a href=/ua>Home</a></li><li><a href=/ua/tags/>Tags</a></li><div class=spacer></div><ul class=language-selector><ul class=language-selector-current><li>Ukraine ▾</li></ul><ul class="language-selector__more hidden"><li><a href=/>English</a></li><li><a href=/ua/>Ukraine</a></li></ul></ul></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/ua>Home</a></li><li><a href=/ua/tags/>Tags</a></li><hr><li><a href=/>English</a></li><li><a href=/ua/>Ukraine</a></li></ul></nav></header><div class=content><div class=post><h1 class=post-title><a href=/ua/2020/09/30/nightfall-dlp-configuration/>Nightfall Dlp Configuration</a></h1><div class=post-meta><span class=post-date>2020-09-30</span>
<span class=post-author>:: Maksym Postument</span></div><span class=post-tags>#<a href=/ua/tags/aws/>AWS</a>&nbsp;
#<a href=/ua/tags/dlp/>DLP</a>&nbsp;
#<a href=/ua/tags/github/>Github</a>&nbsp;</span>
<img src=https://i.imgur.com/j2fDweo.jpg class=post-cover alt="Nightfall Dlp Configuration"><div class=post-content><div><p>Привіт!</p><p>Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.</p><h2 id=github-action>Github Action<a href=#github-action class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу.
Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=color:#f92672>name</span>: <span style=color:#ae81ff>nightfalldlp</span>
<span style=color:#f92672>on</span>:
  <span style=color:#f92672>push</span>:
    <span style=color:#f92672>branches</span>:
      - <span style=color:#ae81ff>master</span>
  <span style=color:#f92672>pull_request</span>:
<span style=color:#f92672>jobs</span>:
  <span style=color:#f92672>run-nightfalldlp</span>:
    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nightfalldlp</span>
    <span style=color:#f92672>runs-on</span>: <span style=color:#ae81ff>ubuntu-latest</span>
    <span style=color:#f92672>steps</span>:
      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Checkout Repo Action</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>actions/checkout@v2</span>

      - <span style=color:#f92672>name</span>: <span style=color:#ae81ff>nightfallDLP action step</span>
        <span style=color:#f92672>uses</span>: <span style=color:#ae81ff>nightfallai/nightfall_dlp_action@v0.0.7</span>
        <span style=color:#f92672>env</span>:
          <span style=color:#f92672>NIGHTFALL_API_KEY</span>: <span style=color:#ae81ff>${{ secrets.NIGHTFALL_API_KEY }}</span>
          <span style=color:#f92672>GITHUB_TOKEN</span>: <span style=color:#ae81ff>${{ secrets.GITHUB_TOKEN }}</span>
          <span style=color:#f92672>EVENT_BEFORE</span>: <span style=color:#ae81ff>${{ github.event.before }}</span>
</code></pre></div><p>В секції on вказано що сканування запускати на push в master бренчу та на Pull Request.<br>Action має два кроки, перший це клонувати репозиторій другий це запустити сканер.<br>Для роботи сканера необхідно декілька env зміних. GITHUB_TOKEN використовується для того щоб сканер міг добавляти коментарі в PR значення його має бути <code>secrets.GITHUB_TOKEN</code><br><img src=https://i.imgur.com/13N6AjR.png alt=Comment></p><p>EVENT_BEFORE потрібен потрібне у випадку якщо сканер запускається на push event. І значення в нього має бути <code>github.event.before</code><br>NIGHTFALL_API_KEY остання потрібна зміна, отримати її можна зареєструвавшись на <a href=https://nightfall.ai/api>nightfall.ai</a>. Після того NIGHTFALL_API_KEY отримано його потрібно добавити в GitHub Secrets<br><img src=https://i.imgur.com/8y5a2FH.png alt=Secret></p><h2 id=nightfall-configuration>Nightfall Configuration<a href=#nightfall-configuration class=hanchor arialabel=Anchor>&#8983;</a></h2><p>Після того я з GitHub Action закінчено потрібно створити конфігураційни файл для Nightfall.<br>Для цього створіть папку з назвою <code>.nightfalldlp</code> і в ньому файл <code>config.json</code>.<br>Список детекторів які підтримує nightfall.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;detectors&#34;</span>: [
    <span style=color:#e6db74>&#34;CREDIT_CARD_NUMBER&#34;</span>,
    <span style=color:#e6db74>&#34;PHONE_NUMBER&#34;</span>,
    <span style=color:#e6db74>&#34;API_KEY&#34;</span>,
    <span style=color:#e6db74>&#34;CRYPTOGRAPHIC_KEY&#34;</span>,
    <span style=color:#e6db74>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span>,
    <span style=color:#e6db74>&#34;US_SOCIAL_SECURITY_NUMBER&#34;</span>,
    <span style=color:#e6db74>&#34;AMERICAN_BANKERS_CUSIP_ID&#34;</span>,
    <span style=color:#e6db74>&#34;US_BANK_ROUTING_MICR&#34;</span>,
    <span style=color:#e6db74>&#34;ICD9_CODE&#34;</span>,
    <span style=color:#e6db74>&#34;ICD10_CODE&#34;</span>,
    <span style=color:#e6db74>&#34;US_DRIVERS_LICENSE_NUMBER&#34;</span>,
    <span style=color:#e6db74>&#34;US_PASSPORT&#34;</span>,
    <span style=color:#e6db74>&#34;EMAIL_ADDRESS&#34;</span>,
    <span style=color:#e6db74>&#34;IP_ADDRESS&#34;</span>
  ]
}
</code></pre></div><p>Мій конфігураційни файл виглядає коротшим тому що з повним генерує велику кількість false positive алармів. Наприклад<br><img src=https://i.imgur.com/0EGejo0.png alt=FalseErrorSample></p><p>Приклад мого файлу:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-json data-lang=json>{
  <span style=color:#f92672>&#34;detectors&#34;</span>: [
    <span style=color:#e6db74>&#34;API_KEY&#34;</span>,
    <span style=color:#e6db74>&#34;CRYPTOGRAPHIC_KEY&#34;</span>,
    <span style=color:#e6db74>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span>,
    <span style=color:#e6db74>&#34;EMAIL_ADDRESS&#34;</span>,
    <span style=color:#e6db74>&#34;IP_ADDRESS&#34;</span>
  ]
}
</code></pre></div><p>Тепер це все потрібно закомітити сканер запуститься.<br>Навіть при такій конфігурації сканер видає багато false positive аларміві результат я отримую щоразу<br><img src=https://i.imgur.com/bJ1WWR2.png alt=Error>
Наприклад отримую такий еррор
Suspicious content detected (3:<em><strong>, type IP_ADDRESS) на <code>"arn:aws:s3:::usershome/{{name}}-{{data}}/*"</code><br>Або Suspicious content detected (ke</strong></em>*****, type RANDOMLY_GENERATED_TOKEN) на<br><code>"Resource": "arn:aws:kms:us-east-1:000000000:key/6a2b4d78-oy69-44ab-ce3d-43faca87fd14"</code>.<br>Незважаючи на частину false positive сканер дозволяє знайти закомічені паролі та api ключі</p></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=/ua/2020/10/01/blazor-server-routing/><span class=button__icon>←</span>
<span class=button__text>Blazor Server Routing</span></a></span>
<span class="button next"><a href=/ua/2020/09/16/deploy-to-ec2-with-codeship/><span class=button__text>Deploy to ec2 with codedship</span>
<span class=button__icon>→</span></a></span></div></div></div></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2020 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script src=/assets/main.js></script><script src=/assets/prism.js></script><script src=/assets/languageSelector.js></script></div></body></html>