<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Nightfall Dlp Configuration &#183; Maksym Postument</title><meta name=description content="Привіт!
Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.
Github Action Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу. Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.
name:nightfalldlpon:push:branches:- masterpull_request:jobs:run-nightfalldlp:name:nightfalldlpruns-on:ubuntu-lateststeps:- name:Checkout Repo Actionuses:actions/checkout@v2- name:nightfallDLP action stepuses:nightfallai/nightfall_dlp_action@v0.0.7env:NIGHTFALL_API_KEY:${{ secrets."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.75.1"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Nightfall Dlp Configuration"><meta property="og:description" content="Привіт!
Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.
Github Action Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу. Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.
name:nightfalldlpon:push:branches:- masterpull_request:jobs:run-nightfalldlp:name:nightfalldlpruns-on:ubuntu-lateststeps:- name:Checkout Repo Actionuses:actions/checkout@v2- name:nightfallDLP action stepuses:nightfallai/nightfall_dlp_action@v0.0.7env:NIGHTFALL_API_KEY:${{ secrets."><meta property="og:type" content="article"><meta property="og:url" content="/ua/2020/09/30/nightfall-dlp-configuration/"><link rel=stylesheet href=/dist/site.css><link rel=stylesheet href=/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176839804-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>mpostument.com</a></h1><a class="button-square button-social hint--top" data-hint=Twitter aria-label=Twitter href=https://twitter.com/Maks_Postument rel=me><i class="fa fa-twitter" aria-hidden=true></i></a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/mpostument rel=me><i class="fa fa-github-alt" aria-hidden=true></i></a><a class="button-square button-social hint--top" data-hint=Email aria-label="Send an Email" href=mailto:777rip777@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=/about/>About</a></li><li class=site-nav-item><a href=/>Home</a></li><li class=site-nav-item><a href=/projects/>Projects</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Nightfall Dlp Configuration</h1><p class=post-date><span>Published <time datetime=2020-09-30 itemprop=datePublished>Wed, Sep 30, 2020</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/mpostument itemprop=url rel=author>Maksym Postument</a></span></span></p><p class="post-reading post-line"><span>2 min</span></p><nav class=LangNav>Language:
<a href=/2020/09/30/nightfall-dlp-configuration/>English</a></nav></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=https://i.imgur.com/j2fDweo.jpg><p>Привіт!</p><p>Хочу сьогодні розказати про DLP Nightfall. Він дозволяє сканувати Pull Request на наявність на наявність персональної інформації, api ключів та інше.</p><h2 id=github-action>Github Action</h2><p>Для Github Nightfall дає Action який можна використовувати для сканування Pull Request та Merge в бренчу.
Для початку потрібно створити в корені репозиторія папку .github\workflows і в цій папці створити файл dlp.yml. Назва файлу можу бути будь якою.</p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfalldlp</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>master</span><span class=w>
</span><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>run-nightfalldlp</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfalldlp</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout Repo Action</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfallDLP action step</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>nightfallai/nightfall_dlp_action@v0.0.7</span><span class=w>
</span><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>NIGHTFALL_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.NIGHTFALL_API_KEY }}</span><span class=w>
</span><span class=w>          </span><span class=nt>GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GITHUB_TOKEN }}</span><span class=w>
</span><span class=w>          </span><span class=nt>EVENT_BEFORE</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event.before }}</span><span class=w>
</span></code></pre></div><p>В секції on вказано що сканування запускати на push в master бренчу та на Pull Request.<br>Action має два кроки, перший це клонувати репозиторій другий це запустити сканер.<br>Для роботи сканера необхідно декілька env зміних. GITHUB_TOKEN використовується для того щоб сканер міг добавляти коментарі в PR значення його має бути <code>secrets.GITHUB_TOKEN</code><br><img src=https://i.imgur.com/13N6AjR.png alt=Comment></p><p>EVENT_BEFORE потрібен потрібне у випадку якщо сканер запускається на push event. І значення в нього має бути <code>github.event.before</code><br>NIGHTFALL_API_KEY остання потрібна зміна, отримати її можна зареєструвавшись на <a href=https://nightfall.ai/api>nightfall.ai</a>. Після того NIGHTFALL_API_KEY отримано його потрібно добавити в GitHub Secrets<br><img src=https://i.imgur.com/8y5a2FH.png alt=Secret></p><h2 id=nightfall-configuration>Nightfall Configuration</h2><p>Після того я з GitHub Action закінчено потрібно створити конфігураційни файл для Nightfall.<br>Для цього створіть папку з назвою <code>.nightfalldlp</code> і в ньому файл <code>config.json</code>.<br>Список детекторів які підтримує nightfall.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;detectors&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;CREDIT_CARD_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;PHONE_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;API_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;CRYPTOGRAPHIC_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_SOCIAL_SECURITY_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;AMERICAN_BANKERS_CUSIP_ID&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_BANK_ROUTING_MICR&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ICD9_CODE&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ICD10_CODE&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_DRIVERS_LICENSE_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_PASSPORT&#34;</span><span class=p>,</span>
    <span class=s2>&#34;EMAIL_ADDRESS&#34;</span><span class=p>,</span>
    <span class=s2>&#34;IP_ADDRESS&#34;</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>Мій конфігураційни файл виглядає коротшим тому що з повним генерує велику кількість false positive алармів. Наприклад<br><img src=https://i.imgur.com/0EGejo0.png alt=FalseErrorSample></p><p>Приклад мого файлу:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;detectors&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;API_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;CRYPTOGRAPHIC_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span><span class=p>,</span>
    <span class=s2>&#34;EMAIL_ADDRESS&#34;</span><span class=p>,</span>
    <span class=s2>&#34;IP_ADDRESS&#34;</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>Тепер це все потрібно закомітити сканер запуститься.<br>Навіть при такій конфігурації сканер видає багато false positive аларміві результат я отримую щоразу<br><img src=https://i.imgur.com/bJ1WWR2.png alt=Error>
Наприклад отримую такий еррор
Suspicious content detected (3:<em><strong>, type IP_ADDRESS) на <code>"arn:aws:s3:::usershome/{{name}}-{{data}}/*"</code><br>Або Suspicious content detected (ke</strong></em>*****, type RANDOMLY_GENERATED_TOKEN) на<br><code>"Resource": "arn:aws:kms:us-east-1:000000000:key/6a2b4d78-oy69-44ab-ce3d-43faca87fd14"</code>.<br>Незважаючи на частину false positive сканер дозволяє знайти закомічені паролі та api ключі</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/ua/tags/aws/>AWS</a>,
<a href=/ua/tags/dlp/>DLP</a>,
<a href=/ua/tags/github/>Github</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Nightfall%20Dlp%20Configuration&url=%2fua%2f2020%2f09%2f30%2fnightfall-dlp-configuration%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;" aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i></a></div></footer></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>mpostument.com</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2020 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=/js/jquery-1.11.3.min.js></script><script src=/js/jquery.fitvids.js></script><script src=/js/scripts.js></script></body></html>