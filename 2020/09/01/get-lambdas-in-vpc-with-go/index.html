<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Get Lambdas in Vpc With Go &#183; Maksym Postument</title><meta name=description content="Hi there!
Today I want to tell you how with go you can get a list of all AWS Lambda that are in the VPC. First you need to install golang. The latest version can be downloaded from the official website.
Once golang is installed, create a folder for the scripts mkdir awsscripts
Next you need to initialize the go.mod file. This file stores all the dependencies on external packages, and at the same time will make the go code module."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.74.3"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Get Lambdas in Vpc With Go"><meta property="og:description" content="Hi there!
Today I want to tell you how with go you can get a list of all AWS Lambda that are in the VPC. First you need to install golang. The latest version can be downloaded from the official website.
Once golang is installed, create a folder for the scripts mkdir awsscripts
Next you need to initialize the go.mod file. This file stores all the dependencies on external packages, and at the same time will make the go code module."><meta property="og:type" content="article"><meta property="og:url" content="/2020/09/01/get-lambdas-in-vpc-with-go/"><link rel=stylesheet href=/dist/site.css><link rel=stylesheet href=/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176839804-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=mpostument.com href=/>mpostument.com</a></h1><a class=button-square href=/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/Maks_Postument rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/mpostument rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint=Email title=Email href=mailto:777rip777@gmail.com><i class="fa fa-envelope"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=About href=/about/>About</a></li><li class=site-nav-item><a title=Home href=/>Home</a></li><li class=site-nav-item><a title=Projects href=/projects/>Projects</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Get Lambdas in Vpc With Go</h1><p class=post-date><span>Published <time datetime=2020-09-01 itemprop=datePublished>Tue, Sep 1, 2020</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/mpostument itemprop=url rel=author>Maksym Postument</a></span></span></p><p class="post-reading post-line"><span>4 min</span></p></header><nav class=LangNav>Language:
<a href=/ua/2020/09/01/get-lambdas-in-vpc-with-go/>Ukrainian</a>
<a href=/ru/2020/09/01/get-lambdas-in-vpc-with-go/>Russian</a></nav><div class="post-content clearfix" itemprop=articleBody><p><img src=https://i.imgur.com/buHP8rF.png?1 alt=AWSGO><br>Hi there!</p><p>Today I want to tell you how with go you can get a list of all AWS Lambda that are in the VPC.
First you need to install golang. The latest version can be downloaded from the official <a href=https://golang.org/dl/>website</a>.</p><p>Once golang is installed, create a folder for the scripts
<code>mkdir awsscripts</code></p><p>Next you need to initialize the go.mod file. This file stores all the dependencies on external packages, and at the same time will make the go code module. And in the future it can be installed with <code>go get</code>. To create a module you need to call the command <code>go mod init github.com/mpostument/awsscripts</code>. Where github&mldr; is the name of the module. If you use another version control system, it could be it, then the user name and module name.</p><p>Once the module is created we will need aws-sdk to work with aws. You can install it with the command <code>go get github.com/aws/aws-sdk-go@latest</code>. Run it in the directory with go.mod. After that in go mod the version aws-sdk will be added <code>require github.com/aws/aws-sdk-go v1.34.14</code>. In the future, to update the version of aws-sdk. Manually change the version in this file and run <code>go mod tidy</code>.</p><p>The setting is complete and you can go to the code.
Create a <code>lambdaInVpc.go</code> file in the root of the <code>awsscripts</code> folder or in any other folder inside of the <code>awsscripts</code> and open it.</p><p>Each go file starts with <code>package</code>. Since we need to run the go file directly instead of importing <code>package</code> should be <code>main</code>.</p><p>You also need to add a list of third-party modules that we will use</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kn>import</span> <span class=p>(</span>
	<span class=s>&#34;fmt&#34;</span>
	<span class=s>&#34;log&#34;</span>

	<span class=s>&#34;github.com/aws/aws-sdk-go/aws/session&#34;</span>
	<span class=s>&#34;github.com/aws/aws-sdk-go/service/lambda&#34;</span>
<span class=p>)</span>
</code></pre></div><p>The list of imports is followed by the <code>main</code> method, which is the entry point into the code. In <code>main</code> we will create an aws client.</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>main</span><span class=p>()</span> <span class=p>{</span>
    <span class=nx>mySession</span> <span class=o>:=</span> <span class=nx>session</span><span class=p>.</span><span class=nf>Must</span><span class=p>(</span><span class=nx>session</span><span class=p>.</span><span class=nf>NewSession</span><span class=p>())</span>
    <span class=nx>client</span> <span class=o>:=</span> <span class=nx>lambda</span><span class=p>.</span><span class=nf>New</span><span class=p>(</span><span class=nx>mySession</span><span class=p>)</span>
    <span class=nx>lambdas</span> <span class=o>:=</span> <span class=nf>getLambdaFunctions</span><span class=p>(</span><span class=nx>client</span><span class=p>)</span>
<span class=p>}</span>
</code></pre></div><p>This creates an aws session and a lambda client, and method <code>getLambdaFunctions</code> executed. As parameter it take newly created client. Now let&rsquo;s start writing <code>getLambdaFunctions</code>.</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go><span class=kd>func</span> <span class=nf>getLambdaFunctions</span><span class=p>(</span><span class=nx>client</span> <span class=o>*</span><span class=nx>lambda</span><span class=p>.</span><span class=nx>Lambda</span><span class=p>)</span> <span class=p>[]</span><span class=o>*</span><span class=nx>lambda</span><span class=p>.</span><span class=nx>FunctionConfiguration</span> <span class=p>{</span>
	<span class=nx>input</span> <span class=o>:=</span> <span class=o>&amp;</span><span class=nx>lambda</span><span class=p>.</span><span class=nx>ListFunctionsInput</span><span class=p>{}</span>

	<span class=kd>var</span> <span class=nx>result</span> <span class=p>[]</span><span class=o>*</span><span class=nx>lambda</span><span class=p>.</span><span class=nx>FunctionConfiguration</span>

	<span class=nx>err</span> <span class=o>:=</span> <span class=nx>client</span><span class=p>.</span><span class=nf>ListFunctionsPages</span><span class=p>(</span><span class=nx>input</span><span class=p>,</span>
		<span class=kd>func</span><span class=p>(</span><span class=nx>page</span> <span class=o>*</span><span class=nx>lambda</span><span class=p>.</span><span class=nx>ListFunctionsOutput</span><span class=p>,</span> <span class=nx>lastPage</span> <span class=kt>bool</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
			<span class=nx>result</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>result</span><span class=p>,</span> <span class=nx>page</span><span class=p>.</span><span class=nx>Functions</span><span class=o>...</span><span class=p>)</span>
			<span class=k>return</span> <span class=p>!</span><span class=nx>lastPage</span>
		<span class=p>})</span>
	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
		<span class=nx>log</span><span class=p>.</span><span class=nf>Fatal</span><span class=p>(</span><span class=s>&#34;Not able to get lambdas&#34;</span><span class=p>,</span> <span class=nx>err</span><span class=p>)</span>
		<span class=k>return</span> <span class=kc>nil</span>
	<span class=p>}</span>
	<span class=k>return</span> <span class=nx>result</span>
<span class=p>}</span>
</code></pre></div><p>Now let&rsquo;s look at what&rsquo;s going on here. To get the list of lambdas it is necessary to call method <code>ListFunctions</code>. But since this method returns only the first 50 lambdas, it does not suit us. Because if there are 51 or more lambdas on aws, the account will still return only the first 50. But aws has a method with pagination <code>ListFunctionsPages</code>, and it can be used here. The method takes two parameters, the first search parameter <code>ListFunctionsInput</code> in which you can specify the region, version and several other parameters. And the second is the method of pagination.</p><p>In the beginning we create two variables <code>input</code> of type <code>ListFunctionsInput</code> and <code>result</code> of type<code>[]*lambda.FunctionConfiguration</code>. <code>Input</code> will be passed to the <code>ListFunctionsPages</code> function and <code>result</code> will be used to store the execution result.</p><p>Then comes the call of <code>ListFunctionsPages</code>. This method returns only an error, the result of this method is assigned to the variable err and then there is a check whether this varialbe is not equal to <code>nil</code>. If the method returned <code>nil</code> then the program is terminated and the error is displayed.</p><p>In the function <code>ListFunctionsPages</code> there is a call of one more function which adds result of execution in a slice <code>result</code>. The internal function is called several times until we reach the last page. And in the end we return <code>result</code>.</p><p>Now that you have received a list of all lambdas, you need to filter out those in the VPC. For this purpose we will return again to the main method and to add there iterations on all lambdas with a condition.</p><div class=highlight><pre class=chroma><code class=language-go data-lang=go>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>l</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>lambdas</span> <span class=p>{</span>
		<span class=k>if</span> <span class=nx>l</span><span class=p>.</span><span class=nx>VpcConfig</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=o>&amp;&amp;</span> <span class=nb>len</span><span class=p>(</span><span class=nx>l</span><span class=p>.</span><span class=nx>VpcConfig</span><span class=p>.</span><span class=nx>SubnetIds</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
			<span class=nx>fmt</span><span class=p>.</span><span class=nf>Println</span><span class=p>(</span><span class=o>*</span><span class=nx>l</span><span class=p>.</span><span class=nx>FunctionName</span><span class=p>)</span>
		<span class=p>}</span>
    <span class=p>}</span>
</code></pre></div><p>Here we iterate on result of execution of <code>getLambdaFunctions</code> and we will check up whether <code>VpcConfig</code> of function is not equal <code>nil</code> and whether the list of subnet is more than zero. Two checks are necessary because for some lambdas <code>VpcConfig</code> will be nil, and for others there will be a map in which there will be empty lists. Example</p><pre><code>&lt;nil&gt;
&lt;nil&gt;
{
  SecurityGroupIds: [],
  SubnetIds: [],
  VpcId: &quot;&quot;
}
&lt;nil&gt;
</code></pre><p>Now you can run the code and get the result.<br><code>go run lambdaInVpc.go</code></p></div><footer class="post-footer clearfix"><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Get%20Lambdas%20in%20Vpc%20With%20Go&url=%2f2020%2f09%2f01%2fget-lambdas-in-vpc-with-go%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=%2f2020%2f09%2f01%2fget-lambdas-in-vpc-with-go%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a>
<a class=icon-google-plus href="https://plus.google.com/share?url=%2f2020%2f09%2f01%2fget-lambdas-in-vpc-with-go%2f" onclick="window.open(this.href,'google-plus-share','width=490,height=530');return false;"><i class="fa fa-google-plus"></i><span class=hidden>Google+</span></a></div></footer></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=mpostument.com href=/>mpostument.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2020 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=/js/jquery-1.11.3.min.js></script><script src=/js/jquery.fitvids.js></script><script src=/js/scripts.js></script></body></html>