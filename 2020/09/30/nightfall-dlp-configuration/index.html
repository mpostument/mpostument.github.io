<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Nightfall Dlp Configuration &#183; Maksym Postument</title><meta name=description content="Hi there!
I want to talk today about DLP Nightfall. It allows you to scan Pull Request for personal information, api keys and more.
Github Action Nightfall gives GitHub Action which can be used to scan Pull Request and Push in the branch. First you need to create a .github\workflows folder in the root of the repository and create a dlp.yml file in this folder. The file name can be any."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.75.1"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Nightfall Dlp Configuration"><meta property="og:description" content="Hi there!
I want to talk today about DLP Nightfall. It allows you to scan Pull Request for personal information, api keys and more.
Github Action Nightfall gives GitHub Action which can be used to scan Pull Request and Push in the branch. First you need to create a .github\workflows folder in the root of the repository and create a dlp.yml file in this folder. The file name can be any."><meta property="og:type" content="article"><meta property="og:url" content="/2020/09/30/nightfall-dlp-configuration/"><link rel=stylesheet href=/dist/site.css><link rel=stylesheet href=/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176839804-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>mpostument.com</a></h1><a class="button-square button-social hint--top" data-hint=Twitter aria-label=Twitter href=https://twitter.com/Maks_Postument rel=me><i class="fa fa-twitter" aria-hidden=true></i></a><a class="button-square button-social hint--top" data-hint=Github aria-label=Github href=https://github.com/mpostument rel=me><i class="fa fa-github-alt" aria-hidden=true></i></a><a class="button-square button-social hint--top" data-hint=Email aria-label="Send an Email" href=mailto:777rip777@gmail.com><i class="fa fa-envelope" aria-hidden=true></i></a></div><ul class=site-nav><li class=site-nav-item><a href=/about/>About</a></li><li class=site-nav-item><a href=/>Home</a></li><li class=site-nav-item><a href=/projects/>Projects</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Nightfall Dlp Configuration</h1><p class=post-date><span>Published <time datetime=2020-09-30 itemprop=datePublished>Wed, Sep 30, 2020</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/mpostument itemprop=url rel=author>Maksym Postument</a></span></span></p><p class="post-reading post-line"><span>2 min</span></p><nav class=LangNav>Language:
<a href=/ua/2020/09/30/nightfall-dlp-configuration/>Ukrainian</a></nav></header><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=https://i.imgur.com/j2fDweo.jpg><p>Hi there!</p><p>I want to talk today about DLP Nightfall. It allows you to scan Pull Request for personal information, api keys and more.</p><h2 id=github-action>Github Action</h2><p>Nightfall gives GitHub Action which can be used to scan Pull Request and Push in the branch.
First you need to create a <code>.github\workflows</code> folder in the root of the repository and create a dlp.yml file in this folder. The file name can be any.</p><div class=highlight><pre class=chroma><code class=language-yml data-lang=yml><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfalldlp</span><span class=w>
</span><span class=w></span><span class=nt>on</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>push</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>branches</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=l>master</span><span class=w>
</span><span class=w>  </span><span class=nt>pull_request</span><span class=p>:</span><span class=w>
</span><span class=w></span><span class=nt>jobs</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=nt>run-nightfalldlp</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfalldlp</span><span class=w>
</span><span class=w>    </span><span class=nt>runs-on</span><span class=p>:</span><span class=w> </span><span class=l>ubuntu-latest</span><span class=w>
</span><span class=w>    </span><span class=nt>steps</span><span class=p>:</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Checkout Repo Action</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>actions/checkout@v2</span><span class=w>
</span><span class=w>
</span><span class=w>      </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>nightfallDLP action step</span><span class=w>
</span><span class=w>        </span><span class=nt>uses</span><span class=p>:</span><span class=w> </span><span class=l>nightfallai/nightfall_dlp_action@v0.0.7</span><span class=w>
</span><span class=w>        </span><span class=nt>env</span><span class=p>:</span><span class=w>
</span><span class=w>          </span><span class=nt>NIGHTFALL_API_KEY</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.NIGHTFALL_API_KEY }}</span><span class=w>
</span><span class=w>          </span><span class=nt>GITHUB_TOKEN</span><span class=p>:</span><span class=w> </span><span class=l>${{ secrets.GITHUB_TOKEN }}</span><span class=w>
</span><span class=w>          </span><span class=nt>EVENT_BEFORE</span><span class=p>:</span><span class=w> </span><span class=l>${{ github.event.before }}</span><span class=w>
</span></code></pre></div><p>In the <code>on</code> section it is specified that to start scanning on push in master brunch and on Pull Request.
Action has two steps, the first is to clone the repository the second is to run the scanner.
Several env variables are required for the scanner to work. GITHUB_TOKEN is used so that the scanner can add comments to the PR it should have value <code>secrets.GITHUB_TOKEN</code><br><img src=https://i.imgur.com/13N6AjR.png alt=Comment></p><p>EVENT_BEFORE is required if the scanner starts at a push event. And its value must be <code>github.event.before</code><br>NIGHTFALL_API_KEY the last required variable, you can get it by registering at <a href=https://nightfall.ai/api>nightfall.ai</a>. Once NIGHTFALL_API_KEY is received it needs to be added to GitHub Secrets<br><img src=https://i.imgur.com/8y5a2FH.png alt=Secret></p><h2 id=nightfall-configuration>Nightfall Configuration</h2><p>Now when i finished with GitHub Action I need to create a configuration file for Nightfall.
To do this, create a folder named <code>.nightfalldlp</code> and the file <code>config.json</code> in it.
List of detectors that support nightfall.</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;detectors&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;CREDIT_CARD_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;PHONE_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;API_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;CRYPTOGRAPHIC_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_SOCIAL_SECURITY_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;AMERICAN_BANKERS_CUSIP_ID&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_BANK_ROUTING_MICR&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ICD9_CODE&#34;</span><span class=p>,</span>
    <span class=s2>&#34;ICD10_CODE&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_DRIVERS_LICENSE_NUMBER&#34;</span><span class=p>,</span>
    <span class=s2>&#34;US_PASSPORT&#34;</span><span class=p>,</span>
    <span class=s2>&#34;EMAIL_ADDRESS&#34;</span><span class=p>,</span>
    <span class=s2>&#34;IP_ADDRESS&#34;</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>My configuration file looks shorter because the full one generates a lot of false-positive alarms. Example<br><img src=https://i.imgur.com/0EGejo0.png alt=FalseErrorSample></p><p>Example of my file:</p><div class=highlight><pre class=chroma><code class=language-json data-lang=json><span class=p>{</span>
  <span class=nt>&#34;detectors&#34;</span><span class=p>:</span> <span class=p>[</span>
    <span class=s2>&#34;API_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;CRYPTOGRAPHIC_KEY&#34;</span><span class=p>,</span>
    <span class=s2>&#34;RANDOMLY_GENERATED_TOKEN&#34;</span><span class=p>,</span>
    <span class=s2>&#34;EMAIL_ADDRESS&#34;</span><span class=p>,</span>
    <span class=s2>&#34;IP_ADDRESS&#34;</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div><p>Now it&rsquo;s all you need to push configuration for scanner to start.<br>Even with this configuration, the scanner gives a lot of false-positive alarm results<br><img src=https://i.imgur.com/bJ1WWR2.png alt=Error>
For example, I get such a error
<code>Suspicious content detected (3:***, type IP_ADDRESS)</code> on <code>"arn:aws:s3:::usershome/{{name}}-{{data}}/*"</code><br>Або <code>Suspicious content detected (ke********, type RANDOMLY_GENERATED_TOKEN)</code> on<br><code>"Resource": "arn:aws:kms:us-east-1:000000000:key/6a2b4d78-oy69-44ab-ce3d-43faca87fd14"</code>.<br>Despite the false-positive part, the scanner allows you to find cluttered passwords and api keys</p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/tags/aws/>AWS</a>,
<a href=/tags/dlp/>DLP</a>,
<a href=/tags/github/>Github</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Nightfall%20Dlp%20Configuration&url=%2f2020%2f09%2f30%2fnightfall-dlp-configuration%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;" aria-label="Share on Twitter"><i class="fa fa-twitter" aria-hidden=true></i></a></div></footer></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a href=/>mpostument.com</a></h1><a class="button-square button-jump-top js-jump-top" href=# aria-label="Back to Top"><i class="fa fa-angle-up" aria-hidden=true></i></a></div><p class=footer-copyright><span>&copy; 2020 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=/js/jquery-1.11.3.min.js></script><script src=/js/jquery.fitvids.js></script><script src=/js/scripts.js></script></body></html>