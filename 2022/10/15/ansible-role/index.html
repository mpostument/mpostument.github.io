<!doctype html><html lang=en><head><title>Ansible Role :: Maksym Postument</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Fourth article in series about ansible. In this article, I will what is roles and how to use them"><meta name=keywords content="VSCode,Devops,Ansible,pyenv,RedHat,Beginner,virtualenv,boto3"><meta name=robots content="noodp"><link rel=canonical href=https://mpostument.com/2022/10/15/ansible-role/><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script>
<script>var doNotTrack=!1;if(!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC",{anonymize_ip:!1})}</script><link rel=stylesheet href=/style.css><link rel="shortcut icon" href=https://mpostument.com/img/theme-colors/blue.png><link rel=apple-touch-icon href=https://mpostument.com/img/theme-colors/blue.png><meta name=twitter:card content="summary"><meta name=twitter:site content="mpostument.com"><meta name=twitter:creator content="Maks_Postument"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="og:title" content="Ansible Role"><meta property="og:description" content="Fourth article in series about ansible. In this article, I will what is roles and how to use them"><meta property="og:url" content="https://mpostument.com/2022/10/15/ansible-role/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:image" content="https://mpostument.com/ansible/ansible-role.jpg"><meta property="og:image:width" content="1200"><meta property="og:image:height" content="627"><meta property="article:section" content="Devops"><meta property="article:section" content="Ansible"><meta property="article:section" content="Beginner"><meta property="article:published_time" content="2022-10-15 17:49:02 +0300 +0300"><p align=center style=background-color:#23b0ff>Sign up for my <a href=https://tinyletter.com/mpostument>email
newsletter</a> or use this <a href=/index.xml>RSS feed</a> to get notified of new blog posts.</p><script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8633398301520801" crossorigin=anonymous></script></head><body class=blue><div class="container center headings--one-size"><header class=header><div class=header__inner><div class=header__logo><a href=/><div class=logo>mpostument.com</div></a></div><div class=menu-trigger>menu</div></div><nav class="menu hidden-on-mobile"><ul class="menu__inner menu__inner--desktop"><li><a href=/>Home</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li><li><a href=/projects/>Projects</a></li></ul><span class=spacer></span><ul class="menu__inner menu__inner--desktop"><li><ul class=language-selector><li class=language-selector-current>English&nbsp;▾</li><li><ul class="language-selector__more hidden"><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></li></ul></li></ul><ul class="menu__inner menu__inner--mobile"><li><a href=/>Home</a></li><li><a href=/categories/>Categories</a></li><li><a href=/tags/>Tags</a></li><li><a href=/projects/>Projects</a></li><hr><li><a href=https://mpostument.com/>English</a></li><li><a href=https://mpostument.com/ua/>Ukraine</a></li></ul></nav></header><div class=content><article class=post><h1 class=post-title><a href=https://mpostument.com/2022/10/15/ansible-role/>Ansible Role</a></h1><div class=post-meta><time class=post-date>2022-10-15 ::</time>
<span class=post-author>Maksym Postument</span>
<span class=post-reading-time>:: 7 min read (1398 words)</span></div><span class=post-tags>#<a href=https://mpostument.com/tags/vscode/>VSCode</a>&nbsp;
#<a href=https://mpostument.com/tags/devops/>Devops</a>&nbsp;
#<a href=https://mpostument.com/tags/ansible/>Ansible</a>&nbsp;
#<a href=https://mpostument.com/tags/pyenv/>pyenv</a>&nbsp;
#<a href=https://mpostument.com/tags/redhat/>RedHat</a>&nbsp;
#<a href=https://mpostument.com/tags/beginner/>Beginner</a>&nbsp;</span>
<img src=https://mpostument.com/ansible/ansible-role.jpg class=post-cover alt="Ansible Role" title="Cover Image"><div class=table-of-contents><h2>Table of Contents</h2><nav id=TableOfContents><ul><li><a href=#create-a-role>Create a Role</a></li><li><a href=#ansible-galaxy>Ansible galaxy</a></li><li><a href=#video>Video</a></li></ul></nav></div><div class=post-content><div><p><a href=https://mpostument.com/2022/09/19/manage-ansible-versions-with-pyenv/ title="Part 1 - Manage Ansible Versions With pyenv">Part 1 - Manage Ansible Versions With pyenv</a><br><a href=https://mpostument.com/2022/09/27/ansible-inventory/ title="Part 2 - Ansible Inventory">Part 2 - Ansible Inventory</a><br><a href=https://mpostument.com/2022/10/04/ansible-playbook/ title="Part 3 - Ansible Playbook">Part 3 - Ansible Playbook</a></p><p>Hello!</p><p>So what is a role in Ansible? Roles are a logical organization of Ansible code. For example, you can create a role that will install a MySQL database, put it in a separate repository, and make it publicly available or shared with other teams, and everyone should be able to use it</p><h2 id=create-a-role>Create a Role<a href=#create-a-role class=hanchor arialabel=Anchor>&#8983;</a></h2><p>So how to create a role? You can create all the necessary files and folders manually or use the command <code>ansible-galaxy role init ROLE_NAME</code>.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ansible-galaxy role init roles/httpd
</span></span><span style=display:flex><span>- Role roles/httpd was created successfully
</span></span></code></pre></div><p>I specify roles/httpd for ansible to create the <code>roles</code> folder. If roles/ is not specified, the role will be created in the folder where the command was executed.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree roles
</span></span><span style=display:flex><span>roles
</span></span><span style=display:flex><span>└── httpd
</span></span><span style=display:flex><span>    ├── README.md
</span></span><span style=display:flex><span>    ├── defaults
</span></span><span style=display:flex><span>    │   └── main.yml
</span></span><span style=display:flex><span>    ├── files
</span></span><span style=display:flex><span>    ├── handlers
</span></span><span style=display:flex><span>    │   └── main.yml
</span></span><span style=display:flex><span>    ├── meta
</span></span><span style=display:flex><span>    │   └── main.yml
</span></span><span style=display:flex><span>    ├── tasks
</span></span><span style=display:flex><span>    │   └── main.yml
</span></span><span style=display:flex><span>    ├── templates
</span></span><span style=display:flex><span>    ├── tests
</span></span><span style=display:flex><span>    │   ├── inventory
</span></span><span style=display:flex><span>    │   └── test.yml
</span></span><span style=display:flex><span>    └── vars
</span></span><span style=display:flex><span>        └── main.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>9</span> directories, <span style=color:#ae81ff>8</span> files
</span></span></code></pre></div><p>What is inside the roles/httpd folder?</p><ul><li>defaults - here are the parameters that have the lowest priority, that is, the default values ​​of the parameters that can then be overwritten.</li><li>files - static files required for the role</li><li>handlers - handlers, this is code that is always executed at the very end, under certain conditions. For example, restart the service if the configuration file has changed.</li><li>meta - meta-information about the role. Title, version, author, etc</li><li>tasks - here are the tasks that will be performed by Ansible</li><li>templates - a place for files that will be dynamically generated using jinja2</li><li>tests - tests</li><li>vars - parameters that have a higher priority than the default</li></ul><p>The main folder in which we will work tasks. Our role will install httpd, so in main.yml we will add the code that will install httpd depending on the OS.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install apache on Redhat</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.yum</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;RedHat&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Install apache on Debian</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.apt</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>apache2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>latest</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;Debian&#34;</span>
</span></span></code></pre></div><p>After running the playbook, the httpd package will be installed but not started. To start it and enable automatic start after OS restart, we will use the <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/service_module.html>service</a> module</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Start service httpd, if not started</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>apache2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>started</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;Debian&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Start service httpd, if not started</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>started</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>enabled</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;RedHat&#34;</span>
</span></span></code></pre></div><p>Now ansible will start the httpd service on the server. Let&rsquo;s add the index.html page using a template. To do this, I will create an index.html.j2 file with the following content in the templates folder</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-html data-lang=html><span style=display:flex><span>&lt;<span style=color:#f92672>b</span>&gt;Hello {{ user_name }}!&lt;/<span style=color:#f92672>b</span>&gt;
</span></span></code></pre></div><p>Where <code>{{ user_name }}</code> is an ansible parameter that will be inserted into the generated file. But for this, you need to create a parameter. I will create it in defaults/main.yml.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span><span style=color:#f92672>user_name</span>: <span style=color:#ae81ff>Maksym</span>
</span></span></code></pre></div><p>And finally, there is a task that will generate the file. I will add it to tasks/main.yml.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Generate index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>src</span>: <span style=color:#ae81ff>index.html.j2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>/var/www/html/index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>true</span>
</span></span></code></pre></div><p>We can also use handlers. For example, if you want httpd to restart every time index.html is updated. To do this, I will add the following to handlers/main.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Restart service httpd Debian</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>apache2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>restarted</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;Debian&#34;</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Restart service httpd Redhat</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>ansible.builtin.service</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>name</span>: <span style=color:#ae81ff>httpd</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>state</span>: <span style=color:#ae81ff>restarted</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>yes</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>when</span>: <span style=color:#ae81ff>ansible_facts[&#39;os_family&#39;] == &#34;RedHat&#34;</span>
</span></span></code></pre></div><p>This is similar to the code that start httpd in the tasks folder. But this code will be called only when someone notifies handlers to run, and in our case, it will be called by creating index.html. In the code where we create index.html, we need to add a handler call.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Generate index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>template</span>:
</span></span><span style=display:flex><span>    <span style=color:#f92672>src</span>: <span style=color:#ae81ff>index.html.j2</span>
</span></span><span style=display:flex><span>    <span style=color:#f92672>dest</span>: <span style=color:#ae81ff>/var/www/html/index.html</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>notify</span>:
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Restart service httpd Debian</span>
</span></span><span style=display:flex><span>  - <span style=color:#ae81ff>Restart service httpd Redhat</span>
</span></span></code></pre></div><p>Here I am calling two handlers, but only one will actually be executed depending on the OS.</p><p>Now the role can be used. To do this, in our main main.yml we can specify the role which we are going to use. But without roles/ in the name.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yaml data-lang=yaml><span style=display:flex><span>---
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure webserver</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>gather_facts</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>httpd</span>
</span></span></code></pre></div><p>main.yml located outside of roles folders. This is what the final file structure looks like</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ tree ansible
</span></span><span style=display:flex><span>ansible
</span></span><span style=display:flex><span>├── inventory
</span></span><span style=display:flex><span>├── main.yml
</span></span><span style=display:flex><span>└── roles
</span></span><span style=display:flex><span>    └── httpd
</span></span><span style=display:flex><span>        ├── README.md
</span></span><span style=display:flex><span>        ├── defaults
</span></span><span style=display:flex><span>        │   └── main.yml
</span></span><span style=display:flex><span>        ├── files
</span></span><span style=display:flex><span>        ├── handlers
</span></span><span style=display:flex><span>        │   └── main.yml
</span></span><span style=display:flex><span>        ├── meta
</span></span><span style=display:flex><span>        │   └── main.yml
</span></span><span style=display:flex><span>        ├── tasks
</span></span><span style=display:flex><span>        │   └── main.yml
</span></span><span style=display:flex><span>        ├── templates
</span></span><span style=display:flex><span>        │   └── index.html.j2
</span></span><span style=display:flex><span>        ├── tests
</span></span><span style=display:flex><span>        │   ├── inventory
</span></span><span style=display:flex><span>        │   └── test.yml
</span></span><span style=display:flex><span>        └── vars
</span></span><span style=display:flex><span>            └── main.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#ae81ff>10</span> directories, <span style=color:#ae81ff>11</span> files
</span></span></code></pre></div><p>And the result</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ansible-playbook -i inventory main.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY <span style=color:#f92672>[</span>Configure webserver<span style=color:#f92672>]</span> *************************************************************************************************
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>Gathering Facts<span style=color:#f92672>]</span> *****************************************************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>httpd : Install apache on redhat<span style=color:#f92672>]</span> ************************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>httpd : Start httpd<span style=color:#f92672>]</span> *************************************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>httpd : Generate index.html<span style=color:#f92672>]</span> *****************************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RUNNING HANDLER <span style=color:#f92672>[</span>httpd : Restart httpd<span style=color:#f92672>]</span> ************************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY RECAP *****************************************************************************************************************
</span></span><span style=display:flex><span>44.201.242.83              : ok<span style=color:#f92672>=</span><span style=color:#ae81ff>5</span>    changed<span style=color:#f92672>=</span><span style=color:#ae81ff>4</span>    unreachable<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    failed<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    skipped<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    rescued<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    ignored<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=ansible-galaxy>Ansible galaxy<a href=#ansible-galaxy class=hanchor arialabel=Anchor>&#8983;</a></h2><p>The Ansible community has many great roles created. You can find them at <a href=https://galaxy.ansible.com/>ansible galaxy</a>. For example, after entering <code>httpd</code> in the search, I found a <a href=https://galaxy.ansible.com/buluma/httpd>role</a> that installs httpd. Here you can read the role documentation and instructions on how to download it.
This would normally be <code>ansible-galaxy install ROLE_NAME</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>$ ansible-galaxy install buluma.httpd
</span></span><span style=display:flex><span>Starting galaxy role install process
</span></span><span style=display:flex><span>- downloading role <span style=color:#e6db74>&#39;httpd&#39;</span>, owned by buluma
</span></span><span style=display:flex><span>- downloading role from https://github.com/buluma/ansible-role-httpd/archive/1.0.9.tar.gz
</span></span><span style=display:flex><span>- extracting buluma.httpd to /home/maksym/.ansible/roles/buluma.httpd
</span></span><span style=display:flex><span>- buluma.httpd <span style=color:#f92672>(</span>1.0.9<span style=color:#f92672>)</span> was installed successfully
</span></span></code></pre></div><p>Now I can specify this role in main.yml</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-yml data-lang=yml><span style=display:flex><span>---
</span></span><span style=display:flex><span>- <span style=color:#f92672>name</span>: <span style=color:#ae81ff>Configure webserver</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>hosts</span>: <span style=color:#ae81ff>web</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>gather_facts</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>become</span>: <span style=color:#66d9ef>true</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>  <span style=color:#f92672>roles</span>:
</span></span><span style=display:flex><span>    - <span style=color:#ae81ff>buluma.httpd</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-shell data-lang=shell><span style=display:flex><span>ansible-playbook -i inventory main.yml
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY <span style=color:#f92672>[</span>Configure webserver<span style=color:#f92672>]</span> *************************************************************************************************
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>Gathering Facts<span style=color:#f92672>]</span> *****************************************************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_servername is set correctly<span style=color:#f92672>]</span> ************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_port is set correctly<span style=color:#f92672>]</span> ******************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> https_ssl_enable is set correctly<span style=color:#f92672>]</span> ************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_ssl_servername is set correctly<span style=color:#f92672>]</span> ********************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_ssl_port is set correctly<span style=color:#f92672>]</span> **************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_locations is set correctly<span style=color:#f92672>]</span> *************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item in httpd_locations is set correctly<span style=color:#f92672>]</span> *****************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_vhosts is set correctly<span style=color:#f92672>]</span> ****************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item in httpd_vhosts is set correctly<span style=color:#f92672>]</span> ********************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item.create_docroot in httpd_vhosts is set correctly<span style=color:#f92672>]</span> *****************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item.serveralias in httpd_vhosts is set correctly<span style=color:#f92672>]</span> ********************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_directories is set correctly<span style=color:#f92672>]</span> ***********************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item.name in httpd_directories is set correctly<span style=color:#f92672>]</span> **********************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item.options in httpd_directories is set correctly<span style=color:#f92672>]</span> *******************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> item.allow_override in httpd_directories is set correctly<span style=color:#f92672>]</span> ************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Test <span style=color:#66d9ef>if</span> httpd_remove_example is set correctly<span style=color:#f92672>]</span> ********************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83 -&gt; localhost<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Install apache httpd<span style=color:#f92672>]</span> *********************************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Modify selinux settings<span style=color:#f92672>]</span> ******************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>(</span>item<span style=color:#f92672>=</span>httpd_can_network_connect<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Allow connections to custom port<span style=color:#f92672>]</span> *********************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>(</span>item<span style=color:#f92672>=</span>80<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>(</span>item<span style=color:#f92672>=</span>443<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure httpd<span style=color:#f92672>]</span> **************************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Install ssl packages<span style=color:#f92672>]</span> *********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Place configuration<span style=color:#f92672>]</span> **********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure redirect from http to https<span style=color:#f92672>]</span> ****************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Enable modules<span style=color:#f92672>]</span> ***************************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>(</span>item<span style=color:#f92672>=</span>proxy<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span> <span style=color:#f92672>=</span>&gt; <span style=color:#f92672>(</span>item<span style=color:#f92672>=</span>proxy_http<span style=color:#f92672>)</span> 
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure locations<span style=color:#f92672>]</span> **********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Create docroot<span style=color:#f92672>]</span> ***************************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure vhosts<span style=color:#f92672>]</span> *************************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure ports<span style=color:#f92672>]</span> **************************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Create directories<span style=color:#f92672>]</span> ***********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Configure directories<span style=color:#f92672>]</span> ********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Flush handlers<span style=color:#f92672>]</span> ***************************************************************************************
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RUNNING HANDLER <span style=color:#f92672>[</span>buluma.httpd : Test httpd configuration validity<span style=color:#f92672>]</span> *********************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>RUNNING HANDLER <span style=color:#f92672>[</span>buluma.httpd : Restart httpd<span style=color:#f92672>]</span> *****************************************************************************
</span></span><span style=display:flex><span>changed: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Removing default html<span style=color:#f92672>]</span> ********************************************************************************
</span></span><span style=display:flex><span>skipping: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>TASK <span style=color:#f92672>[</span>buluma.httpd : Start and enable httpd<span style=color:#f92672>]</span> *******************************************************************************
</span></span><span style=display:flex><span>ok: <span style=color:#f92672>[</span>44.201.242.83<span style=color:#f92672>]</span>
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>PLAY RECAP *****************************************************************************************************************
</span></span><span style=display:flex><span>44.201.242.83              : ok<span style=color:#f92672>=</span><span style=color:#ae81ff>12</span>   changed<span style=color:#f92672>=</span><span style=color:#ae81ff>2</span>    unreachable<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    failed<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    skipped<span style=color:#f92672>=</span><span style=color:#ae81ff>23</span>   rescued<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>    ignored<span style=color:#f92672>=</span><span style=color:#ae81ff>0</span>
</span></span></code></pre></div><h2 id=video>Video<a href=#video class=hanchor arialabel=Anchor>&#8983;</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe src=https://www.youtube.com/embed/oeihNr9e5I4 style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 allowfullscreen title="YouTube Video"></iframe></div></div></div><div class=pagination><div class=pagination__title><span class=pagination__title-h>Read other posts</span><hr></div><div class=pagination__buttons><span class="button previous"><a href=https://mpostument.com/2022/10/19/ansible-vault/><span class=button__icon>←</span>
<span class=button__text>Ansible Vault</span></a></span>
<span class="button next"><a href=https://mpostument.com/2022/10/04/ansible-playbook/><span class=button__text>Ansible Playbook</span>
<span class=button__icon>→</span></a></span></div></div><div id=disqus_thread></div><script type=application/javascript>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></div><footer class=footer><div class=footer__inner><div class=copyright><span>© 2022 Powered by <a href=http://gohugo.io>Hugo</a></span>
<span>:: Theme made by <a href=https://twitter.com/panr>panr</a></span></div></div></footer><script type=text/javascript src=/bundle.min.js></script></div></body></html>