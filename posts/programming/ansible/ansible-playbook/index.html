<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Ansible Playbook | Maksym Postument</title><meta name=keywords content="VSCode,Devops,Ansible,pyenv,RedHat,Beginner,virtualenv,boto3"><meta name=description content="Third article in series about ansible. In this article, I will show how to use a playbook to create reusable code"><meta name=author content="Maksym Postument"><link rel=canonical href=https://mpostument.com/posts/programming/ansible/ansible-playbook/><link crossorigin=anonymous href=/assets/css/stylesheet.d6fcd20a4fb86efa4dfac8ec95da60244cc8871042183da1ef28e3a762ad79c8.css integrity="sha256-1vzSCk+4bvpN+sjsldpgJEzIhxBCGD2h7yjjp2Ktecg=" rel="preload stylesheet" as=style><link rel=icon href=https://mpostument.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mpostument.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mpostument.com/favicon/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://mpostument.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://mpostument.com/favicon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mpostument.com/posts/programming/ansible/ansible-playbook/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC")}</script><meta property="og:url" content="https://mpostument.com/posts/programming/ansible/ansible-playbook/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:title" content="Ansible Playbook"><meta property="og:description" content="Third article in series about ansible. In this article, I will show how to use a playbook to create reusable code"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-10-04T22:51:59+03:00"><meta property="article:modified_time" content="2022-10-04T22:51:59+03:00"><meta property="article:tag" content="VSCode"><meta property="article:tag" content="Devops"><meta property="article:tag" content="Ansible"><meta property="article:tag" content="Pyenv"><meta property="article:tag" content="RedHat"><meta property="article:tag" content="Beginner"><meta property="og:image" content="https://mpostument.com/ansible/ansible-playbook.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://mpostument.com/ansible/ansible-playbook.jpg"><meta name=twitter:title content="Ansible Playbook"><meta name=twitter:description content="Third article in series about ansible. In this article, I will show how to use a playbook to create reusable code"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"","item":"https://mpostument.com/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://mpostument.com/posts/programming/"},{"@type":"ListItem","position":3,"name":"Ansible Playbook","item":"https://mpostument.com/posts/programming/ansible/ansible-playbook/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Ansible Playbook","name":"Ansible Playbook","description":"Third article in series about ansible. In this article, I will show how to use a playbook to create reusable code","keywords":["VSCode","Devops","Ansible","pyenv","RedHat","Beginner","virtualenv","boto3"],"articleBody":"Hello!\nToday I will show what ansible-playbook is and how to create it.\nPlaybook Ansible Playbooks is an iterative, reusable, configuration management and deployment framework that is well-suited for deploying complex applications. If you need to run a task with Ansible more than once, you can do it with a playbook.\nLet’s create the simplest playbook. In the playbook, you need to specify its name, the group of servers on which it will be executed, and the tasks themselves.\n--- - name: Update web servers hosts: webapp tasks: - name: Ensure apache is at the latest version ansible.builtin.yum: name: httpd state: latest become: true In this example, the playbook is executed on the webapp server group. On all servers from this group, ansible installs the latest version of the httpd package using the yum module. Before executing the task, ansible checks whether the package is installed, if it is installed, nothing will happen.\nThe playbook is started using the ansible-playbook command. Let’s save our playbook under the name main.yml and run it\n$ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Ensure apache is at the latest version] ********************************************************************************** changed: [3.92.61.18] PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Ansible host variables Before the playbook starts executing, ansible collects information about the server. This option can be disabled by specifying gather_facts: false in the playbook. Ansible collects a lot of information about the operating system, network settings, and more in this way\n{ \"ansible_all_ipv4_addresses\": [ \"REDACTED IP ADDRESS\" ], \"ansible_all_ipv6_addresses\": [ \"REDACTED IPV6 ADDRESS\" ], \"ansible_apparmor\": { \"status\": \"disabled\" }, \"ansible_architecture\": \"x86_64\", \"ansible_bios_date\": \"10/02/2022\", \"ansible_bios_version\": \"4.1.5\", To see all information, you can call the run command ansible command setup, and all parameters will be printed.\nansible -i inventory all -m ansible.builtin.setup Debug Sometimes you need to debug the execution of the playbook or look at the values of some parameters, all this can be done using the debug module.\nFor example, I need to see the value of the ansible_bios_version parameter, obtained using gather_facts in the playbook startup process. This can be done like this:\n- name: Print bios version ansible.builtin.debug: msg: Bios version is {{ ansible_bios_version }} $ ansible-playbook -i inventory main.yml ✘ INT  ansible-210 3.9.13 17:29:55 PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Print bios version] ****************************************************************************************************** ok: [3.92.61.18] =\u003e { \"msg\": \"Bios version is 4.11.amazon\" } PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Register and Set Facts Also, in Ansible, you can create parameters based on the result of the task. For example, I want to get how long the system has been running. This can be done by calling the Linux uptime command. But if I do it like this:\n- name: Get uptime information ansible.builtin.shell: /usr/bin/uptime $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Get uptime information] ************************************************************************************************** changed: [3.92.61.18] PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 As a result, I get nothing. To get a response from the uptime command, I need to save the result in a variable. This is done using register: VAR_NAME and then the value of this variable can be output to the terminal.\n- name: Get uptime information ansible.builtin.shell: /usr/bin/uptime register: sys_uptime - name: Print system uptime ansible.builtin.debug: msg: \"{{ sys_uptime }}\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Get uptime information] ************************************************************************************************** changed: [3.92.61.18] TASK [Print system uptime] ***************************************************************************************************** ok: [3.92.61.18] =\u003e { \"msg\": { \"changed\": true, \"cmd\": \"/usr/bin/uptime\", \"delta\": \"0:00:00.005060\", \"end\": \"2022-10-07 14:31:50.846284\", \"failed\": false, \"msg\": \"\", \"rc\": 0, \"start\": \"2022-10-07 14:31:50.841224\", \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \" 14:31:50 up 15 min, 1 user, load average: 0,01, 0,05, 0,02\", \"stdout_lines\": [ \" 14:31:50 up 15 min, 1 user, load average: 0,01, 0,05, 0,02\" ] } } PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=3 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 If during execution you need to create a parameter, this can be done using the [set_fact] (https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html) module\n- name: Setting host facts using complex arguments ansible.builtin.set_fact: important_var: important_value - name: Print important value ansible.builtin.debug: msg: \"{{ important_var }}\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Setting host facts using complex arguments] ****************************************************************************** ok: [3.92.61.18] TASK [Print important value] *************************************************************************************************** ok: [3.92.61.18] =\u003e { \"msg\": \"important_value\" } PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=3 changed=0 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Condition It is good when the playbook is universal and can work on different operating systems. But what if we have specific tasks that should be performed in Ubuntu but not in RedHat. This can be done using conditions. Let’s try to create a universal playbook that will install apache http regardless of the OS version. For RedHat we need to use the yum module and for Ubuntu apt. Let’s use the condition when\n- name: Install apache on Redhat ansible.builtin.yum: name: httpd state: latest when: ansible_facts['os_family'] == \"RedHat\" - name: Install apache on Debian ansible.builtin.apt: name: apache2 state: latest when: ansible_facts['os_family'] == \"Debian\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Install apache on Redhat] ************************************************************************************************ ok: [3.92.61.18] TASK [Install apache on Debian] ************************************************************************************************ skipping: [3.92.61.18] PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=0 unreachable=0 failed=0 skipped=1 rescued=0 ignored=0 Thus, the task is executed only if the condition returns `True’, otherwise not.\nBlock Block is used to logically combine tasks in Ansible. For example, you can organize all tasks for Ubuntu and apply a condition at the block level. For example, sometimes not.\n- name: Debian block block: - name: Install apache on Ubuntu ansible.builtin.apt: name: apache2 state: latest - name: Start service apache2, if not started ansible.builtin.service: name: apache2 state: started when: ansible_facts['os_family'] == \"Debian\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Install apache on Ubuntu] ************************************************************************************************ skipping: [3.92.61.18] TASK [Start service apache2, if not started] *********************************************************************************** skipping: [3.92.61.18] PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=1 changed=0 unreachable=0 failed=0 skipped=2 rescued=0 ignored=0 You can also handle errors using rescue and always. The rescue block is executed only if an error occurs in the main block. Always is always launched, regardless of what happened in the previous block.\n- name: Error block block: - name: Print a message ansible.builtin.debug: msg: 'I execute normally' - name: Force a failure ansible.builtin.command: /bin/false - name: Never print this ansible.builtin.debug: msg: 'I never execute, due to the above task failing, :-(' rescue: - name: Print when errors ansible.builtin.debug: msg: 'I caught an error' - name: Force a failure in middle of recovery! \u003e:-) ansible.builtin.command: /bin/false - name: Never print this ansible.builtin.debug: msg: 'I also never execute :-(' always: - name: Always do this ansible.builtin.debug: msg: \"This always executes\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Print a message] ********************************************************************************************************* ok: [3.92.61.18] =\u003e { \"msg\": \"I execute normally\" } TASK [Force a failure] ********************************************************************************************************* fatal: [3.92.61.18]: FAILED! =\u003e {\"changed\": true, \"cmd\": [\"/bin/false\"], \"delta\": \"0:00:00.003974\", \"end\": \"2022-10-07 14:37:27.522485\", \"msg\": \"non-zero return code\", \"rc\": 1, \"start\": \"2022-10-07 14:37:27.518511\", \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"\", \"stdout_lines\": []} TASK [Print when errors] ******************************************************************************************************* ok: [3.92.61.18] =\u003e { \"msg\": \"I caught an error\" } TASK [Force a failure in middle of recovery! \u003e:-)] ***************************************************************************** fatal: [3.92.61.18]: FAILED! =\u003e {\"changed\": true, \"cmd\": [\"/bin/false\"], \"delta\": \"0:00:00.002841\", \"end\": \"2022-10-07 14:37:30.324774\", \"msg\": \"non-zero return code\", \"rc\": 1, \"start\": \"2022-10-07 14:37:30.321933\", \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"\", \"stdout_lines\": []} TASK [Always do this] ********************************************************************************************************** ok: [3.92.61.18] =\u003e { \"msg\": \"This always executes\" } PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=4 changed=0 unreachable=0 failed=1 skipped=0 rescued=1 ignored=0 Loop Ansible has several types of loops. Let’s start with the simplest loop through the list. In this programming, we will check only the simplest one\nSimple list In this case, several users (testuser1 and testuser2) are created, which are specified in the loop block, and {{ item }} is specified instead of the user name, which will be replaced by the user name when executed\n- name: Add several users ansible.builtin.user: name: \"{{ item }}\" state: present groups: \"wheel\" loop: - testuser1 - testuser2 become: true $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Add several users] ******************************************************************************************************* changed: [3.92.61.18] =\u003e (item=testuser1) changed: [3.92.61.18] =\u003e (item=testuser2) PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 List of hashes This is how the cycle looks like through the list of hash maps. The cycle looks the same as the previous one but with one difference in the task block the name of the key from the map is added to {{ item }} and then the value of the name field will look like \"{{ item.name }}\" and the group \"{ { item.groups }}\"\n- name: Add several users ansible.builtin.user: name: \"{{ item.name }}\" state: present groups: \"{{ item.groups }}\" loop: - { name: 'testuser3', groups: 'wheel' } - { name: 'testuser4', groups: 'root' } become: true $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Add several users] ******************************************************************************************************* changed: [3.92.61.18] =\u003e (item={'name': 'testuser3', 'groups': 'wheel'}) changed: [3.92.61.18] =\u003e (item={'name': 'testuser4', 'groups': 'root'}) PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Register var in loop If we use a loop and want to use register to save the output of the task, then the result in this case will be saved in a list.\n- name: Register loop output as a variable ansible.builtin.shell: \"echo {{ item }}\"2022-10-02 loop: - \"one\" - \"two\" register: echo - name: Print variable ansible.builtin.debug: msg: \"{{ echo }}\" { \"changed\": true, \"msg\": \"All items completed\", \"results\": [ { \"changed\": true, \"cmd\": \"echo \\\"one\\\" \", \"delta\": \"0:00:00.003110\", \"end\": \"2022-10-02 12:00:05.187153\", \"invocation\": { \"module_args\": \"echo \\\"one\\\"\", \"module_name\": \"shell\" }, \"item\": \"one\", \"rc\": 0, \"start\": \"2022-10-02 12:00:05.184043\", \"stderr\": \"\", \"stdout\": \"one\" }, { \"changed\": true, \"cmd\": \"echo \\\"two\\\" \", \"delta\": \"0:00:00.002920\", \"end\": \"2022-10-02 12:00:05.245502\", \"invocation\": { \"module_args\": \"echo \\\"two\\\"\", \"module_name\": \"shell\" }, \"item\": \"two\", \"rc\": 0, \"start\": \"2022-10-02 12:00:05.242582\", \"stderr\": \"\", \"stdout\": \"two\" } ] } Delegate To delegate_to is used if you need to transfer the execution of tasks to another server or locally. For example, the server is configured, and when finished, it must be added to the load balancer. But the server itself may not have such rights, so the execution of this task can be transferred to a local server that has such rights.\n- name: Add server to load balancer ansible.builtin.command: echo \"Adding to loadbalancer\" delegate_to: 127.0.0.1 $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Add server to load balancer] ********************************************************************************************* changed: [3.92.61.18 -\u003e 127.0.0.1] PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=0 Failed when If ansible executes a shell script, it cannot always correctly determine whether the task was completed successfully or not, in such cases, you can use the parameter failed_when, which will describe in which cases the task is considered not completed successfully\n- name: Making sure the Physical Memory more than 2gb ansible.builtin.shell: \"cat /proc/meminfo|grep -i memtotal|awk '{print $2/1024/1024}'\" register: memory failed_when: \"memory.stdout|float \u003c 2\" $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Making sure the Physical Memory more than 2gb] *************************************************************************** fatal: [3.92.61.18]: FAILED! =\u003e {\"changed\": true, \"cmd\": \"cat /proc/meminfo|grep -i memtotal|awk '{print $2/1024/1024}'\", \"delta\": \"0:00:00.006063\", \"end\": \"2022-10-07 14:46:37.761174\", \"failed_when_result\": true, \"msg\": \"\", \"rc\": 0, \"start\": \"2022-10-07 14:46:37.755111\", \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"0.943119\", \"stdout_lines\": [\"0.943119\"]} PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=1 changed=0 unreachable=0 failed=1 skipped=0 rescued=0 ignored=0 Ignore Errors If we have tasks in which we expect that there may be an error, but we still want to continue the execution, then we can add the parameter ignore_errors: yes and the execution of the playbook will continue.\n- name: Do not count this as a failure ansible.builtin.command: /bin/false ignore_errors: yes $ ansible-playbook -i inventory main.yml PLAY [Update web servers] ****************************************************************************************************** TASK [Gathering Facts] ********************************************************************************************************* ok: [3.92.61.18] TASK [Do not count this as a failure] ****************************************************************************************** fatal: [3.92.61.18]: FAILED! =\u003e {\"changed\": true, \"cmd\": [\"/bin/false\"], \"delta\": \"0:00:00.002920\", \"end\": \"2022-10-07 14:43:48.380284\", \"msg\": \"non-zero return code\", \"rc\": 1, \"start\": \"2022-10-07 14:43:48.377364\", \"stderr\": \"\", \"stderr_lines\": [], \"stdout\": \"\", \"stdout_lines\": []} ...ignoring PLAY RECAP ********************************************************************************************************************* 3.92.61.18 : ok=2 changed=1 unreachable=0 failed=0 skipped=0 rescued=0 ignored=1 Video ","wordCount":"2084","inLanguage":"en","image":"https://mpostument.com/ansible/ansible-playbook.jpg","datePublished":"2022-10-04T22:51:59+03:00","dateModified":"2022-10-04T22:51:59+03:00","author":[{"@type":"Person","name":"Maksym Postument"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://mpostument.com/posts/programming/ansible/ansible-playbook/"},"publisher":{"@type":"Organization","name":"Maksym Postument","logo":{"@type":"ImageObject","url":"https://mpostument.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mpostument.com/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)">
<svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg>
<svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mpostument.com/posts/programming/ title=Programming><span>Programming</span></a></li><li><a href=https://mpostument.com/posts/drawing/ title=Drawing><span>Drawing</span></a></li><li><a href=https://mpostument.com/posts/yoga/ title=Yoga><span>Yoga</span></a></li><li><a href=https://mpostument.com/posts/music/ title=Music><span>Music</span></a></li><li><a href=https://mpostument.com/posts/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://mpostument.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://mpostument.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://mpostument.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://mpostument.com/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://mpostument.com/>Home</a>&nbsp;»&nbsp;<a href=https://mpostument.com/posts/></a>&nbsp;»&nbsp;<a href=https://mpostument.com/posts/programming/></a></div><h1 class="post-title entry-hint-parent">Ansible Playbook</h1><div class=post-description>Third article in series about ansible. In this article, I will show how to use a playbook to create reusable code</div><div class=post-meta><span title='2022-10-04 22:51:59 +0300 +0300'>October 4, 2022</span>&nbsp;·&nbsp;10 min&nbsp;·&nbsp;2084 words&nbsp;·&nbsp;Maksym Postument&nbsp;|&nbsp;<a href=https://github.com/mpostument/content-mpostument/edit/master/content/posts/programming/ansible/ansible-playbook.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><a href=https://mpostument.com/ansible/ansible-playbook.jpg target=_blank rel="noopener noreferrer"><img loading=eager src=https://mpostument.com/ansible/ansible-playbook.jpg alt></a></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><a href=#playbook>Playbook</a></li><li><a href=#ansible-host-variables>Ansible host variables</a></li><li><a href=#debug>Debug</a></li><li><a href=#register-and-set-facts>Register and Set Facts</a></li><li><a href=#condition>Condition</a></li><li><a href=#block>Block</a></li><li><a href=#loop>Loop</a><ul><li><a href=#simple-list>Simple list</a></li><li><a href=#list-of-hashes>List of hashes</a></li><li><a href=#register-var-in-loop>Register var in loop</a></li></ul></li><li><a href=#delegate-to>Delegate To</a></li><li><a href=#failed-when>Failed when</a></li><li><a href=#ignore-errors>Ignore Errors</a></li><li><a href=#video>Video</a></li></ul></nav></div></details></div><div class=post-content><p>Hello!</p><p>Today I will show what ansible-playbook is and how to create it.</p><h2 id=playbook>Playbook<a hidden class=anchor aria-hidden=true href=#playbook>#</a></h2><p>Ansible Playbooks is an iterative, reusable, configuration management and deployment framework that is well-suited for deploying complex applications. If you need to run a task with Ansible more than once, you can do it with a playbook.</p><p>Let&rsquo;s create the simplest playbook. In the playbook, you need to specify its name, the group of servers on which it will be executed, and the tasks themselves.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=nn>---</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Update web servers</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>webapp</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Ensure apache is at the latest version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ansible.builtin.yum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>httpd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><p>In this example, the playbook is executed on the <code>webapp</code> server group. On all servers from this group, ansible installs the latest version of the <code>httpd</code> package using the <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html>yum</a> module. Before executing the task, ansible checks whether the package is installed, if it is installed, nothing will happen.</p><p>The playbook is started using the <code>ansible-playbook</code> command. Let&rsquo;s save our playbook under the name <code>main.yml</code> and run it</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Ensure apache is at the latest version<span class=o>]</span> **********************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=ansible-host-variables>Ansible host variables<a hidden class=anchor aria-hidden=true href=#ansible-host-variables>#</a></h2><p>Before the playbook starts executing, ansible collects information about the server. This option can be disabled by specifying <code>gather_facts: false</code> in the playbook. Ansible collects a lot of information about the operating system, network settings, and more in this way</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-json data-lang=json><span class=line><span class=cl><span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_all_ipv4_addresses&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;REDACTED IP ADDRESS&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_all_ipv6_addresses&#34;</span><span class=p>:</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;REDACTED IPV6 ADDRESS&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>],</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_apparmor&#34;</span><span class=p>:</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nt>&#34;status&#34;</span><span class=p>:</span> <span class=s2>&#34;disabled&#34;</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_architecture&#34;</span><span class=p>:</span> <span class=s2>&#34;x86_64&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_bios_date&#34;</span><span class=p>:</span> <span class=s2>&#34;10/02/2022&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>    <span class=nt>&#34;ansible_bios_version&#34;</span><span class=p>:</span> <span class=s2>&#34;4.1.5&#34;</span><span class=p>,</span>
</span></span></code></pre></div><p>To see all information, you can call the run command ansible command setup, and all parameters will be printed.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>ansible -i inventory all -m ansible.builtin.setup
</span></span></code></pre></div><h2 id=debug>Debug<a hidden class=anchor aria-hidden=true href=#debug>#</a></h2><p>Sometimes you need to debug the execution of the playbook or look at the values of some parameters, all this can be done using the <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/debug_module.html>debug</a> module.</p><p>For example, I need to see the value of the <code>ansible_bios_version</code> parameter, obtained using gather_facts in the playbook startup process. This can be done like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print bios version</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=l>Bios version is {{ ansible_bios_version }}</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml                              ✘ INT  ansible-210 3.9.13 17:29:55
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Print bios version<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;Bios version is 4.11.amazon&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=register-and-set-facts>Register and Set Facts<a hidden class=anchor aria-hidden=true href=#register-and-set-facts>#</a></h2><p>Also, in Ansible, you can create parameters based on the result of the task. For example, I want to get how long the system has been running. This can be done by calling the Linux <code>uptime</code> command. But if I do it like this:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Get uptime information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.shell</span><span class=p>:</span><span class=w> </span><span class=l>/usr/bin/uptime</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Get uptime information<span class=o>]</span> **************************************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><p>As a result, I get nothing. To get a response from the <code>uptime</code> command, I need to save the result in a variable. This is done using <code>register: VAR_NAME</code> and then the value of this variable can be output to the terminal.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Get uptime information</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.shell</span><span class=p>:</span><span class=w> </span><span class=l>/usr/bin/uptime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>sys_uptime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print system uptime</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ sys_uptime }}&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Get uptime information<span class=o>]</span> **************************************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Print system uptime<span class=o>]</span> *****************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;changed&#34;</span>: true,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;cmd&#34;</span>: <span class=s2>&#34;/usr/bin/uptime&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.005060&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-07 14:31:50.846284&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;failed&#34;</span>: false,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;rc&#34;</span>: 0,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-07 14:31:50.841224&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;stderr_lines&#34;</span>: <span class=o>[]</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34; 14:31:50 up 15 min,  1 user,  load average: 0,01, 0,05, 0,02&#34;</span>,
</span></span><span class=line><span class=cl>        <span class=s2>&#34;stdout_lines&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34; 14:31:50 up 15 min,  1 user,  load average: 0,01, 0,05, 0,02&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>]</span>
</span></span><span class=line><span class=cl>    <span class=o>}</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>3</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><p>If during execution you need to create a parameter, this can be done using the [set_fact] (<a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html>https://docs.ansible.com/ansible/latest/collections/ansible/builtin/set_fact_module.html</a>) module</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Setting host facts using complex arguments</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.set_fact</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>important_var</span><span class=p>:</span><span class=w> </span><span class=l>important_value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print important value</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ important_var }}&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Setting host facts using complex arguments<span class=o>]</span> ******************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Print important value<span class=o>]</span> ***************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;important_value&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>3</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=condition>Condition<a hidden class=anchor aria-hidden=true href=#condition>#</a></h2><p>It is good when the playbook is universal and can work on different operating systems. But what if we have specific tasks that should be performed in Ubuntu but not in RedHat. This can be done using conditions. Let&rsquo;s try to create a universal playbook that will install apache http regardless of the OS version. For RedHat we need to use the <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/yum_module.html>yum</a> module and for Ubuntu <a href=https://docs.ansible.com/ansible/latest/collections/ansible/builtin/apt_module.html>apt</a>. Let&rsquo;s use the condition <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_conditionals.html#id2>when</a></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install apache on Redhat</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.yum</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>httpd</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>ansible_facts[&#39;os_family&#39;] == &#34;RedHat&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install apache on Debian</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>ansible_facts[&#39;os_family&#39;] == &#34;Debian&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Install apache on Redhat<span class=o>]</span> ************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Install apache on Debian<span class=o>]</span> ************************************************************************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>1</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><p>Thus, the task is executed only if the condition returns `True&rsquo;, otherwise not.</p><h2 id=block>Block<a hidden class=anchor aria-hidden=true href=#block>#</a></h2><p><a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_blocks.html>Block</a> is used to logically combine tasks in Ansible. For example, you can organize all tasks for Ubuntu and apply a condition at the block level. For example, sometimes not.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Debian block</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>block</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Install apache on Ubuntu</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.apt</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>latest</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Start service apache2, if not started</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.service</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>apache2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>started</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>when</span><span class=p>:</span><span class=w> </span><span class=l>ansible_facts[&#39;os_family&#39;] == &#34;Debian&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Install apache on Ubuntu<span class=o>]</span> ************************************************************************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Start service apache2, <span class=k>if</span> not started<span class=o>]</span> ***********************************************************************************
</span></span><span class=line><span class=cl>skipping: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>1</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>2</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><p>You can also handle errors using rescue and always. The rescue block is executed only if an error occurs in the main block. Always is always launched, regardless of what happened in the previous block.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Error block</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>block</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print a message</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;I execute normally&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Force a failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class=l>/bin/false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Never print this</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;I never execute, due to the above task failing, :-(&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>rescue</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print when errors</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;I caught an error&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Force a failure in middle of recovery! &gt;:-)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class=l>/bin/false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Never print this</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;I also never execute :-(&#39;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>always</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Always do this</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>        </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;This always executes&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Print a message<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;I execute normally&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Force a failure<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>fatal: <span class=o>[</span>3.92.61.18<span class=o>]</span>: FAILED! <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;changed&#34;</span>: true, <span class=s2>&#34;cmd&#34;</span>: <span class=o>[</span><span class=s2>&#34;/bin/false&#34;</span><span class=o>]</span>, <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.003974&#34;</span>, <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-07 14:37:27.522485&#34;</span>, <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;non-zero return code&#34;</span>, <span class=s2>&#34;rc&#34;</span>: 1, <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-07 14:37:27.518511&#34;</span>, <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stderr_lines&#34;</span>: <span class=o>[]</span>, <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stdout_lines&#34;</span>: <span class=o>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Print when errors<span class=o>]</span> *******************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;I caught an error&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Force a failure in middle of recovery! &gt;:-<span class=o>)]</span> *****************************************************************************
</span></span><span class=line><span class=cl>fatal: <span class=o>[</span>3.92.61.18<span class=o>]</span>: FAILED! <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;changed&#34;</span>: true, <span class=s2>&#34;cmd&#34;</span>: <span class=o>[</span><span class=s2>&#34;/bin/false&#34;</span><span class=o>]</span>, <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.002841&#34;</span>, <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-07 14:37:30.324774&#34;</span>, <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;non-zero return code&#34;</span>, <span class=s2>&#34;rc&#34;</span>: 1, <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-07 14:37:30.321933&#34;</span>, <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stderr_lines&#34;</span>: <span class=o>[]</span>, <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stdout_lines&#34;</span>: <span class=o>[]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Always <span class=k>do</span> this<span class=o>]</span> **********************************************************************************************************
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;This always executes&#34;</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>4</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>1</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=loop>Loop<a hidden class=anchor aria-hidden=true href=#loop>#</a></h2><p>Ansible has several types of <a href=https://docs.ansible.com/ansible/latest/user_guide/playbooks_loops.html>loops</a>. Let&rsquo;s start with the simplest loop through the list. In this programming, we will check only the simplest one</p><h3 id=simple-list>Simple list<a hidden class=anchor aria-hidden=true href=#simple-list>#</a></h3><p>In this case, several users (testuser1 and testuser2) are created, which are specified in the loop block, and <code>{{ item }}</code> is specified instead of the user name, which will be replaced by the user name when executed</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add several users</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;wheel&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>loop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>testuser1</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- <span class=l>testuser2</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Add several users<span class=o>]</span> *******************************************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>testuser1<span class=o>)</span>
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>=</span>testuser2<span class=o>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h3 id=list-of-hashes>List of hashes<a hidden class=anchor aria-hidden=true href=#list-of-hashes>#</a></h3><p>This is how the cycle looks like through the list of hash maps. The cycle looks the same as the previous one but with one difference in the task block the name of the key from the map is added to <code>{{ item }}</code> and then the value of the name field will look like <code>"{{ item.name }}"</code> and the group <code>"{ { item.groups }}"</code></p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add several users</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.user</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.name }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>state</span><span class=p>:</span><span class=w> </span><span class=l>present</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>groups</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ item.groups }}&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>loop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- {<span class=w> </span><span class=nt>name: &#39;testuser3&#39;, groups</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;wheel&#39;</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span>- {<span class=w> </span><span class=nt>name: &#39;testuser4&#39;, groups</span><span class=p>:</span><span class=w> </span><span class=s1>&#39;root&#39;</span><span class=w> </span>}<span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>become</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Add several users<span class=o>]</span> *******************************************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;testuser3&#39;</span>, <span class=s1>&#39;groups&#39;</span>: <span class=s1>&#39;wheel&#39;</span><span class=o>})</span>
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18<span class=o>]</span> <span class=o>=</span>&gt; <span class=o>(</span><span class=nv>item</span><span class=o>={</span><span class=s1>&#39;name&#39;</span>: <span class=s1>&#39;testuser4&#39;</span>, <span class=s1>&#39;groups&#39;</span>: <span class=s1>&#39;root&#39;</span><span class=o>})</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h3 id=register-var-in-loop>Register var in loop<a hidden class=anchor aria-hidden=true href=#register-var-in-loop>#</a></h3><p>If we use a loop and want to use <code>register</code> to save the output of the task, then the result in this case will be saved in a list.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Register loop output as a variable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ansible.builtin.shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;echo {{ item }}&#34;</span><span class=ld>2022-10-02</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>loop</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;one&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span>- <span class=s2>&#34;two&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>echo</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Print variable</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ansible.builtin.debug</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>msg</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;{{ echo }}&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl><span class=o>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;changed&#34;</span>: true,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;All items completed&#34;</span>,
</span></span><span class=line><span class=cl>    <span class=s2>&#34;results&#34;</span>: <span class=o>[</span>
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;changed&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;cmd&#34;</span>: <span class=s2>&#34;echo \&#34;one\&#34; &#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.003110&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-02 12:00:05.187153&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;invocation&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;module_args&#34;</span>: <span class=s2>&#34;echo \&#34;one\&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;module_name&#34;</span>: <span class=s2>&#34;shell&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;item&#34;</span>: <span class=s2>&#34;one&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;rc&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-02 12:00:05.184043&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;one&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>,
</span></span><span class=line><span class=cl>        <span class=o>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;changed&#34;</span>: true,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;cmd&#34;</span>: <span class=s2>&#34;echo \&#34;two\&#34; &#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.002920&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-02 12:00:05.245502&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;invocation&#34;</span>: <span class=o>{</span>
</span></span><span class=line><span class=cl>                <span class=s2>&#34;module_args&#34;</span>: <span class=s2>&#34;echo \&#34;two\&#34;&#34;</span>,
</span></span><span class=line><span class=cl>                <span class=s2>&#34;module_name&#34;</span>: <span class=s2>&#34;shell&#34;</span>
</span></span><span class=line><span class=cl>            <span class=o>}</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;item&#34;</span>: <span class=s2>&#34;two&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;rc&#34;</span>: 0,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-02 12:00:05.242582&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>,
</span></span><span class=line><span class=cl>            <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;two&#34;</span>
</span></span><span class=line><span class=cl>        <span class=o>}</span>
</span></span><span class=line><span class=cl>    <span class=o>]</span>
</span></span><span class=line><span class=cl><span class=o>}</span>
</span></span></code></pre></div><h2 id=delegate-to>Delegate To<a hidden class=anchor aria-hidden=true href=#delegate-to>#</a></h2><p><code>delegate_to</code> is used if you need to transfer the execution of tasks to another server or locally. For example, the server is configured, and when finished, it must be added to the load balancer. But the server itself may not have such rights, so the execution of this task can be transferred to a local server that has such rights.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>    </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Add server to load balancer</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class=l>echo &#34;Adding to loadbalancer&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>      </span><span class=nt>delegate_to</span><span class=p>:</span><span class=w> </span><span class=m>127.0.0.1</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Add server to load balancer<span class=o>]</span> *********************************************************************************************
</span></span><span class=line><span class=cl>changed: <span class=o>[</span>3.92.61.18 -&gt; 127.0.0.1<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=failed-when>Failed when<a hidden class=anchor aria-hidden=true href=#failed-when>#</a></h2><p>If ansible executes a shell script, it cannot always correctly determine whether the task was completed successfully or not, in such cases, you can use the parameter <code>failed_when</code>, which will describe in which cases the task is considered not completed successfully</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Making sure the Physical Memory more than 2gb</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>ansible.builtin.shell</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;cat /proc/meminfo|grep -i memtotal|awk &#39;{print $2/1024/1024}&#39;&#34;</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>register</span><span class=p>:</span><span class=w> </span><span class=l>memory</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>failed_when</span><span class=p>:</span><span class=w> </span><span class=s2>&#34;memory.stdout|float &lt; 2&#34;</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Making sure the Physical Memory more than 2gb<span class=o>]</span> ***************************************************************************
</span></span><span class=line><span class=cl>fatal: <span class=o>[</span>3.92.61.18<span class=o>]</span>: FAILED! <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;changed&#34;</span>: true, <span class=s2>&#34;cmd&#34;</span>: <span class=s2>&#34;cat /proc/meminfo|grep -i memtotal|awk &#39;{print </span><span class=nv>$2</span><span class=s2>/1024/1024}&#39;&#34;</span>, <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.006063&#34;</span>, <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-07 14:46:37.761174&#34;</span>, <span class=s2>&#34;failed_when_result&#34;</span>: true, <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;rc&#34;</span>: 0, <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-07 14:46:37.755111&#34;</span>, <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stderr_lines&#34;</span>: <span class=o>[]</span>, <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;0.943119&#34;</span>, <span class=s2>&#34;stdout_lines&#34;</span>: <span class=o>[</span><span class=s2>&#34;0.943119&#34;</span><span class=o>]}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>1</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>0</span>
</span></span></code></pre></div><h2 id=ignore-errors>Ignore Errors<a hidden class=anchor aria-hidden=true href=#ignore-errors>#</a></h2><p>If we have tasks in which we expect that there may be an error, but we still want to continue the execution, then we can add the parameter <code>ignore_errors: yes</code> and the execution of the playbook will continue.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-yaml data-lang=yaml><span class=line><span class=cl>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>Do not count this as a failure</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ansible.builtin.command</span><span class=p>:</span><span class=w> </span><span class=l>/bin/false</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>ignore_errors</span><span class=p>:</span><span class=w> </span><span class=kc>yes</span><span class=w>
</span></span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-shell data-lang=shell><span class=line><span class=cl>$ ansible-playbook -i inventory main.yml
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY <span class=o>[</span>Update web servers<span class=o>]</span> ******************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Gathering Facts<span class=o>]</span> *********************************************************************************************************
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>ok: <span class=o>[</span>3.92.61.18<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>TASK <span class=o>[</span>Do not count this as a failure<span class=o>]</span> ******************************************************************************************
</span></span><span class=line><span class=cl>fatal: <span class=o>[</span>3.92.61.18<span class=o>]</span>: FAILED! <span class=o>=</span>&gt; <span class=o>{</span><span class=s2>&#34;changed&#34;</span>: true, <span class=s2>&#34;cmd&#34;</span>: <span class=o>[</span><span class=s2>&#34;/bin/false&#34;</span><span class=o>]</span>, <span class=s2>&#34;delta&#34;</span>: <span class=s2>&#34;0:00:00.002920&#34;</span>, <span class=s2>&#34;end&#34;</span>: <span class=s2>&#34;2022-10-07 14:43:48.380284&#34;</span>, <span class=s2>&#34;msg&#34;</span>: <span class=s2>&#34;non-zero return code&#34;</span>, <span class=s2>&#34;rc&#34;</span>: 1, <span class=s2>&#34;start&#34;</span>: <span class=s2>&#34;2022-10-07 14:43:48.377364&#34;</span>, <span class=s2>&#34;stderr&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stderr_lines&#34;</span>: <span class=o>[]</span>, <span class=s2>&#34;stdout&#34;</span>: <span class=s2>&#34;&#34;</span>, <span class=s2>&#34;stdout_lines&#34;</span>: <span class=o>[]}</span>
</span></span><span class=line><span class=cl>...ignoring
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>PLAY RECAP *********************************************************************************************************************
</span></span><span class=line><span class=cl>3.92.61.18                 : <span class=nv>ok</span><span class=o>=</span><span class=m>2</span>    <span class=nv>changed</span><span class=o>=</span><span class=m>1</span>    <span class=nv>unreachable</span><span class=o>=</span><span class=m>0</span>    <span class=nv>failed</span><span class=o>=</span><span class=m>0</span>    <span class=nv>skipped</span><span class=o>=</span><span class=m>0</span>    <span class=nv>rescued</span><span class=o>=</span><span class=m>0</span>    <span class=nv>ignored</span><span class=o>=</span><span class=m>1</span>
</span></span></code></pre></div><h2 id=video>Video<a hidden class=anchor aria-hidden=true href=#video>#</a></h2><div style=position:relative;padding-bottom:56.25%;height:0;overflow:hidden><iframe allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" allowfullscreen loading=eager referrerpolicy=strict-origin-when-cross-origin src="https://www.youtube.com/embed/k74GIVucO_Y?autoplay=0&controls=1&end=0&loop=0&mute=0&start=0" style=position:absolute;top:0;left:0;width:100%;height:100%;border:0 title="YouTube video"></iframe></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://mpostument.com/tags/vscode/>VSCode</a></li><li><a href=https://mpostument.com/tags/devops/>Devops</a></li><li><a href=https://mpostument.com/tags/ansible/>Ansible</a></li><li><a href=https://mpostument.com/tags/pyenv/>Pyenv</a></li><li><a href=https://mpostument.com/tags/redhat/>RedHat</a></li><li><a href=https://mpostument.com/tags/beginner/>Beginner</a></li></ul><nav class=paginav><a class=prev href=https://mpostument.com/posts/programming/ansible/ansible-role/><span class=title>« Prev</span><br><span>Ansible Role</span>
</a><a class=next href=https://mpostument.com/posts/programming/ansible/ansible-inventory/><span class=title>Next »</span><br><span>Ansible Inventory</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on x" href="https://x.com/intent/tweet/?text=Ansible%20Playbook&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f&amp;hashtags=VSCode%2cDevops%2cAnsible%2cpyenv%2cRedHat%2cBeginner"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f&amp;title=Ansible%20Playbook&amp;summary=Ansible%20Playbook&amp;source=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f&title=Ansible%20Playbook"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on whatsapp" href="https://api.whatsapp.com/send?text=Ansible%20Playbook%20-%20https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on telegram" href="https://telegram.me/share/url?text=Ansible%20Playbook&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share Ansible Playbook on ycombinator" href="https://news.ycombinator.com/submitlink?t=Ansible%20Playbook&u=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fansible%2fansible-playbook%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2024 <a href=https://mpostument.com/>Maksym Postument</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>