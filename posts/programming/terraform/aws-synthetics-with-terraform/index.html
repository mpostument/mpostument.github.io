<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation | Maksym Postument</title>
<meta name=keywords content="AWS,Terraform,Synthetics,DevOps,Automation"><meta name=description content="Discover the solutions to common problems encountered when using the aws_synthetics_canary Terraform resource and how to overcome them"><meta name=author content="Maksym Postument"><link rel=canonical href=https://mpostument.com/posts/programming/terraform/aws-synthetics-with-terraform/><link crossorigin=anonymous href=/assets/css/stylesheet.f49d66caae9ea0fd43f21f29e71a8d3e284517ed770f2aa86fa012953ad3c9ef.css integrity="sha256-9J1myq6eoP1D8h8p5xqNPihFF+13Dyqob6ASlTrTye8=" rel="preload stylesheet" as=style><link rel=icon href=https://mpostument.com/favicon/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mpostument.com/favicon/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mpostument.com/favicon/favicon/favicon-32x32.png><link rel=apple-touch-icon href=https://mpostument.com/favicon/apple-touch-icon.png><link rel=mask-icon href=https://mpostument.com/favicon/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mpostument.com/posts/programming/terraform/aws-synthetics-with-terraform/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><script async src="https://www.googletagmanager.com/gtag/js?id=G-SBRJXS94DC"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-SBRJXS94DC")}</script><meta property="og:url" content="https://mpostument.com/posts/programming/terraform/aws-synthetics-with-terraform/"><meta property="og:site_name" content="Maksym Postument"><meta property="og:title" content="AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation"><meta property="og:description" content="Discover the solutions to common problems encountered when using the aws_synthetics_canary Terraform resource and how to overcome them"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-03-08T00:00:00+00:00"><meta property="article:modified_time" content="2022-03-08T00:00:00+00:00"><meta property="article:tag" content="AWS"><meta property="article:tag" content="Devops"><meta property="article:tag" content="Terraform"><meta property="article:tag" content="Automation"><meta property="article:tag" content="Observability"><meta property="og:image" content="https://i.imgur.com/a4KQPvv.jpg"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://i.imgur.com/a4KQPvv.jpg"><meta name=twitter:title content="AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation"><meta name=twitter:description content="Discover the solutions to common problems encountered when using the aws_synthetics_canary Terraform resource and how to overcome them"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"","item":"https://mpostument.com/posts/"},{"@type":"ListItem","position":2,"name":"","item":"https://mpostument.com/posts/programming/"},{"@type":"ListItem","position":3,"name":"AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation","item":"https://mpostument.com/posts/programming/terraform/aws-synthetics-with-terraform/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation","name":"AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation","description":"Discover the solutions to common problems encountered when using the aws_synthetics_canary Terraform resource and how to overcome them","keywords":["AWS","Terraform","Synthetics","DevOps","Automation"],"articleBody":"Hi there!\nI recently embarked on a journey to automate the creation of AWS Synthetics using Terraform. Along the way, I encountered a few challenges that I managed to overcome. In this post, I will share my experiences and the solutions I found.\nlocals { common_tags = { cost-center = \"observability\" label = \"canary\" environment = \"staging\" } } data \"archive_file\" \"login\" { type = \"zip\" source_dir = \"${path.module}/functions/login/\" output_path = \"${path.module}/functions/login.zip\" } resource \"aws_synthetics_canary\" \"login\" { name = \"login_test\" artifact_s3_location = \"s3://my_canary_bucket/\" execution_role_arn = \"role_arn\" handler = \"index.handler\" zip_file = data.archive_file.login.output_path runtime_version = \"syn-nodejs-puppeteer-3.4\" start_canary = true schedule { expression = \"rate(5 minutes)\" } run_config { timeout_in_seconds = 300 } tags = merge( local.common_tags ) } Problem 1: Tagging the Automatically Created Lambda The first obstacle I faced was the lack of tags on the Lambda function automatically created by the canary. To address this, I utilized the null_resource in Terraform. The Lambda ARN can be obtained using aws_synthetics_canary.login.engine_arn. However, the ARN includes the lambda version, which is not required for tagging purposes. To remove the version from the Lambda ARN, I added the following code to locals:\nlambda_regex = \"arn:aws:lambda:[a-z]{2}-[a-z]+-\\\\d{1}:\\\\d{12}:function:[a-zA-Z0-9-_]+\" login_lambda_name = regex(local.lambda_regex, aws_synthetics_canary.login.engine_arn) By using the updated ARN with null_resource, I was able to tag the Lambda. The null_resource runs whenever there are changes in the common_tags folder or when the aws_synthetics_canary ID changes. In the provisioner \"local-exec\" block, I utilized the aws lambda tag-resource command to tag the Lambda. However, it’s important to note that aws lambda tag-resource supports tags in the format KeyName1=string,KeyName2=string, while the tags in my code were in a map. To convert them to a string, I added the following code to locals:\ntags = trimsuffix(join(\" \", formatlist(\"%s=%s,\", keys(local.common_tags), values(local.common_tags))), \",\") After creating the aws_synthetics_canary, the Lambda will be tagged using the null_resource.\nresource \"null_resource\" \"tag_login_backend_lambda\" { triggers = { tags = local.tags canary = aws_synthetics_canary.login.id } provisioner \"local-exec\" { command = \"aws lambda tag-resource --resource ${local.login_lambda_name} --tags '${local.tags}'\" environment = { AWS_PROFILE = \"production } } depends_on = [aws_synthetics_canary.login] } Problem 2: Environment Variables Support Another challenge I encountered was the lack of support for environment variables in the aws_synthetics_canary resource. To overcome this limitation, I used the null_resource once again. I added the environment variables to locals, creating a map with the desired variables. In my case, there was only one variable, app_url:\ncanary_variables = { \"app_url\" = \"https://mpostument.com\" } Triggers look similar to the previous example, only canary_variables has a type map and needs to be converted to string because triggers only support the string type. The aws synthetics update-canary command needs to include additional parameters besides environment variables. If they are not provided, the aws cli will set them to default. In my case, I am using values retrieved from the Terraform resource aws_synthetics_canary.login. This guarantees that those parameters will be the same for aws_synthetics_canary.login and null_resource.\nresource \"null_resource\" \"add_environment_variables_login_canary\" { triggers = { canary_variables = join(\",\", [for key, value in local.canary_variables : \"${key}=${value}\"]) canary = aws_synthetics_canary.login.id } provisioner \"local-exec\" { command = \"aws synthetics update-canary --name ${aws_synthetics_canary.login.name} --run-config '${jsonencode({ TimeoutInSeconds : aws_synthetics_canary.create.run_config[0].timeout_in_seconds, MemoryInMB : aws_synthetics_canary.create.run_config[0].memory_in_mb, ActiveTracing : aws_synthetics_canary.create.run_config[0].active_tracing, EnvironmentVariables : var.canary_variables })}'\" environment = { AWS_PROFILE = var.aws_profile_name } } depends_on = [aws_synthetics_canary.create] } Problem 3: Automatic Canary Code Update One of the challenges I encountered was the lack of automatic updates for the canary code. Currently, the canary code does not update automatically, and to trigger an update, the archive name must be different each time. To achieve this, I utilized the filemd5 function, which calculates the hash of the file. By incorporating this function into the archive_file configuration, the canary code is updated whenever the file’s hash changes.\nlocals { login_function_location = \"${path.module}/functions/login/nodejs/node_modules/index.js\" } data \"archive_file\" \"login\" { type = \"zip\" source_dir = \"${path.module}/functions/login/\" output_path = \"${path.module}/functions/login-${filemd5(local.login_function_location)}.zip\" } By incorporating the filemd5 function into the configuration of the archive_file, the hash of the file will be calculated each time. If the hash has changed, a new archive will be created, ensuring that the canary code is updated accordingly.\nProblem 4: Cleanup Issue with terraform destroy One significant issue I encountered is related to the cleanup process when executing terraform destroy. Unfortunately, the automatically created lambda function, aws_synthetics_canary, is not removed as expected. I am currently working on finding a solution to address this problem and ensure proper cleanup of resources when destroying the infrastructure.\nUpdate: Environment Variables Support An exciting update regarding the AWS provider! The latest version, 4.5.0, has introduced support for environment_variables. This means you can now leverage this feature by specifying a map of the required environment variables within the run_config block. It provides a more streamlined approach to managing environment variables for your AWS Synthetics canary.\nI hope these improvements provide better clarity and understanding. If you have any additional questions or suggestions, please let me know.\nlocals { canary_variables = { \"app_url\" = \"https://mpostument.com\" } login_function_location = \"${path.module}/functions/login/nodejs/node_modules/index.js\" } data \"archive_file\" \"login\" { type = \"zip\" source_dir = \"${path.module}/functions/login/\" output_path = \"${path.module}/functions/login-${filemd5(local.login_function_location)}.zip\" resource \"aws_synthetics_canary\" \"login\" { name = \"login_test\" artifact_s3_location = \"s3://my_canary_bucket/\" execution_role_arn = \"role_arn\" handler = \"index.handler\" zip_file = data.archive_file.login.output_path runtime_version = \"syn-nodejs-puppeteer-3.4\" start_canary = true schedule { expression = \"rate(5 minutes)\" } run_config { timeout_in_seconds = 300 environment_variables = local.canary_variables } tags = merge( local.common_tags ) } ","wordCount":"879","inLanguage":"en","image":"https://i.imgur.com/a4KQPvv.jpg","datePublished":"2022-03-08T00:00:00Z","dateModified":"2022-03-08T00:00:00Z","author":{"@type":"Person","name":"Maksym Postument"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mpostument.com/posts/programming/terraform/aws-synthetics-with-terraform/"},"publisher":{"@type":"Organization","name":"Maksym Postument","logo":{"@type":"ImageObject","url":"https://mpostument.com/favicon/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mpostument.com/ accesskey=h title="Home (Alt + H)">Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)" aria-label="Toggle theme"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mpostument.com/posts/programming/ title=Programming><span>Programming</span></a></li><li><a href=https://mpostument.com/posts/drawing/ title=Drawing><span>Drawing</span></a></li><li><a href=https://mpostument.com/posts/yoga/ title=Yoga><span>Yoga</span></a></li><li><a href=https://mpostument.com/posts/music/ title=Music><span>Music</span></a></li><li><a href=https://mpostument.com/posts/projects/ title=Projects><span>Projects</span></a></li><li><a href=https://mpostument.com/search/ title="Search (Alt + /)" accesskey=/><span>Search</span></a></li><li><a href=https://mpostument.com/categories/ title=Categories><span>Categories</span></a></li><li><a href=https://mpostument.com/tags/ title=Tags><span>Tags</span></a></li><li><a href=https://mpostument.com/archives/ title=Archive><span>Archive</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://mpostument.com/>Home</a>&nbsp;»&nbsp;<a href=https://mpostument.com/posts/></a>&nbsp;»&nbsp;<a href=https://mpostument.com/posts/programming/></a></div><h1 class="post-title entry-hint-parent">AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation</h1><div class=post-description>Discover the solutions to common problems encountered when using the aws_synthetics_canary Terraform resource and how to overcome them</div><div class=post-meta><span title='2022-03-08 00:00:00 +0000 UTC'>March 8, 2022</span>&nbsp;·&nbsp;5 min&nbsp;·&nbsp;879 words&nbsp;·&nbsp;Maksym Postument&nbsp;|&nbsp;<a href=https://github.com/mpostument/content-mpostument/edit/master/content/posts/programming/terraform/aws-synthetics-with-terraform.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><figure class=entry-cover><a href=https://i.imgur.com/a4KQPvv.jpg target=_blank rel="noopener noreferrer"><img loading=eager src=https://i.imgur.com/a4KQPvv.jpg alt></a></figure><div class=toc><details><summary accesskey=c title="(Alt + C)"><span class=details>Table of Contents</span></summary><div class=inner><nav id=TableOfContents><ul><li><ul><li><a href=#problem-1-tagging-the-automatically-created-lambda>Problem 1: Tagging the Automatically Created Lambda</a></li><li><a href=#problem-2-environment-variables-support>Problem 2: Environment Variables Support</a></li><li><a href=#problem-3-automatic-canary-code-update>Problem 3: Automatic Canary Code Update</a></li><li><a href=#problem-4-cleanup-issue-with-terraform-destroy>Problem 4: Cleanup Issue with <code>terraform destroy</code></a></li><li><a href=#update-environment-variables-support>Update: Environment Variables Support</a></li></ul></li></ul></nav></div></details></div><div class=post-content><p><strong>Hi there!</strong></p><p>I recently embarked on a journey to automate the creation of <code>AWS Synthetics</code> using Terraform. Along the way, I encountered a few challenges that I managed to overcome. In this post, I will share my experiences and the solutions I found.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>common_tags</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=nx>cost</span><span class=o>-</span><span class=na>center</span> = <span class=s2>&#34;observability&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>label</span>       = <span class=s2>&#34;canary&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>environment</span> = <span class=s2>&#34;staging&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;archive_file&#34;</span> <span class=s2>&#34;login&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>type</span>       = <span class=s2>&#34;zip&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>source_dir</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login/&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>output_path</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login.zip&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_synthetics_canary&#34;</span> <span class=s2>&#34;login&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>                 = <span class=s2>&#34;login_test&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>artifact_s3_location</span> = <span class=s2>&#34;s3://my_canary_bucket/&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>execution_role_arn</span>   = <span class=s2>&#34;role_arn&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>handler</span>              = <span class=nb>&#34;index</span><span class=p>.</span><span class=nx>handler</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  zip_file             = data.archive_file.login.output_path
</span></span></span><span class=line><span class=cl><span class=s2>  runtime_version      = &#34;</span><span class=nx>syn</span><span class=o>-</span><span class=nx>nodejs</span><span class=o>-</span><span class=nx>puppeteer</span><span class=m>-3</span><span class=p>.</span><span class=m>4</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  start_canary         = true
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  schedule {
</span></span></span><span class=line><span class=cl><span class=s2>    expression = &#34;</span><span class=nx>rate</span><span class=p>(</span><span class=m>5</span> <span class=nx>minutes</span><span class=p>)</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  }
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  run_config {
</span></span></span><span class=line><span class=cl><span class=s2>    timeout_in_seconds = 300
</span></span></span><span class=line><span class=cl><span class=s2>  }
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  tags = merge(
</span></span></span><span class=line><span class=cl><span class=s2>    local.common_tags
</span></span></span><span class=line><span class=cl><span class=s2>  )
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span></code></pre></div><h3 id=problem-1-tagging-the-automatically-created-lambda>Problem 1: Tagging the Automatically Created Lambda<a hidden class=anchor aria-hidden=true href=#problem-1-tagging-the-automatically-created-lambda>#</a></h3><p>The first obstacle I faced was the lack of tags on the Lambda function automatically created by the canary. To address this, I utilized the <code>null_resource</code> in Terraform. The Lambda ARN can be obtained using <code>aws_synthetics_canary.login.engine_arn</code>. However, the ARN includes the lambda version, which is not required for tagging purposes. To remove the version from the Lambda ARN, I added the following code to <code>locals</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=na>lambda_regex</span>       = <span class=s2>&#34;arn:aws:lambda:[a-z]{2}-[a-z]+-\\d{1}:\\d{12}:function:[a-zA-Z0-9-_]+&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>login_lambda_name</span>  = <span class=nb>regex</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>lambda_regex</span><span class=p>,</span> <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>login</span><span class=p>.</span><span class=nx>engine_arn</span><span class=p>)</span>
</span></span></code></pre></div><p>By using the updated ARN with <code>null_resource</code>, I was able to tag the Lambda. The <code>null_resource</code> runs whenever there are changes in the <code>common_tags</code> folder or when the <code>aws_synthetics_canary</code> ID changes. In the <code>provisioner "local-exec"</code> block, I utilized the <code>aws lambda tag-resource</code> command to tag the Lambda. However, it&rsquo;s important to note that <code>aws lambda tag-resource</code> supports tags in the format <code>KeyName1=string,KeyName2=string</code>, while the tags in my code were in a map. To convert them to a string, I added the following code to locals:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=na>tags</span>               = <span class=nb>trimsuffix</span><span class=p>(</span><span class=nb>join</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=nb>formatlist</span><span class=p>(</span><span class=s2>&#34;%s=%s,&#34;</span><span class=p>,</span><span class=nb> keys</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>common_tags</span><span class=p>),</span><span class=nb> values</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>common_tags</span><span class=p>))),</span> <span class=s2>&#34;,&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>After creating the <code>aws_synthetics_canary</code>, the Lambda will be tagged using the <code>null_resource</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;null_resource&#34;</span> <span class=s2>&#34;tag_login_backend_lambda&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>triggers</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>tags</span>   = <span class=nx>local</span><span class=p>.</span><span class=nx>tags</span>
</span></span><span class=line><span class=cl>    <span class=na>canary</span> = <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>login</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>  provisioner</span> <span class=s2>&#34;local-exec&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>command</span> = <span class=s2>&#34;aws lambda tag-resource --resource </span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>login_lambda_name</span><span class=si>}</span><span class=s2> --tags &#39;</span><span class=si>${</span><span class=nx>local</span><span class=p>.</span><span class=nx>tags</span><span class=si>}</span><span class=s2>&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>environment</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>AWS_PROFILE</span> = <span class=s2>&#34;production
</span></span></span><span class=line><span class=cl><span class=s2>    }
</span></span></span><span class=line><span class=cl><span class=s2>  }
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  depends_on = [aws_synthetics_canary.login]
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span></code></pre></div><h3 id=problem-2-environment-variables-support>Problem 2: Environment Variables Support<a hidden class=anchor aria-hidden=true href=#problem-2-environment-variables-support>#</a></h3><p>Another challenge I encountered was the lack of support for environment variables in the <code>aws_synthetics_canary</code> resource. To overcome this limitation, I used the <code>null_resource</code> once again. I added the environment variables to <code>locals</code>, creating a map with the desired variables. In my case, there was only one variable, <code>app_url</code>:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl>  <span class=na>canary_variables</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;app_url&#34;</span> <span class=o>=</span> <span class=s2>&#34;https://mpostument.com&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>Triggers look similar to the previous example, only <code>canary_variables</code> has a type map and needs to be converted to string because triggers only support the string type. The <code>aws synthetics update-canary</code> command needs to include additional parameters besides environment variables. If they are not provided, the <code>aws cli</code> will set them to default. In my case, I am using values retrieved from the Terraform resource <code>aws_synthetics_canary.login</code>. This guarantees that those parameters will be the same for <code>aws_synthetics_canary.login</code> and <code>null_resource</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;null_resource&#34;</span> <span class=s2>&#34;add_environment_variables_login_canary&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>triggers</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>canary_variables</span> = <span class=nb>join</span><span class=p>(</span><span class=s2>&#34;,&#34;</span><span class=p>,</span> <span class=p>[</span><span class=k>for</span> <span class=nx>key</span><span class=p>,</span> <span class=nx>value</span> <span class=k>in</span> <span class=nx>local</span><span class=p>.</span><span class=nx>canary_variables</span> <span class=o>:</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nx>key</span><span class=si>}</span><span class=s2>=</span><span class=si>${</span><span class=nx>value</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>    <span class=na>canary</span>           = <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>login</span><span class=p>.</span><span class=nx>id</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>  provisioner</span> <span class=s2>&#34;local-exec&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=na>command</span> = <span class=s2>&#34;aws synthetics update-canary --name </span><span class=si>${</span><span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>login</span><span class=p>.</span><span class=nx>name</span><span class=si>}</span><span class=s2> --run-config &#39;</span><span class=si>${</span><span class=nx>jsonencode</span><span class=p>({</span> <span class=nx>TimeoutInSeconds</span> <span class=o>:</span> <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>create</span><span class=p>.</span><span class=nx>run_config</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nx>timeout_in_seconds</span><span class=p>,</span> <span class=nx>MemoryInMB</span> <span class=o>:</span> <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>create</span><span class=p>.</span><span class=nx>run_config</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nx>memory_in_mb</span><span class=p>,</span> <span class=nx>ActiveTracing</span> <span class=o>:</span> <span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>create</span><span class=p>.</span><span class=nx>run_config</span><span class=p>[</span><span class=m>0</span><span class=p>].</span><span class=nx>active_tracing</span><span class=p>,</span> <span class=nx>EnvironmentVariables</span> <span class=o>:</span> <span class=nb>var</span><span class=p>.</span><span class=nx>canary_variables</span> <span class=si>}</span><span class=s2>)}&#39;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=na>environment</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>      <span class=na>AWS_PROFILE</span> = <span class=nb>var</span><span class=p>.</span><span class=nx>aws_profile_name</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>depends_on</span> = <span class=p>[</span><span class=nx>aws_synthetics_canary</span><span class=p>.</span><span class=nx>create</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h3 id=problem-3-automatic-canary-code-update>Problem 3: Automatic Canary Code Update<a hidden class=anchor aria-hidden=true href=#problem-3-automatic-canary-code-update>#</a></h3><p>One of the challenges I encountered was the lack of automatic updates for the canary code. Currently, the canary code does not update automatically, and to trigger an update, the archive name must be different each time. To achieve this, I utilized the <code>filemd5</code> function, which calculates the hash of the file. By incorporating this function into the <code>archive_file</code> configuration, the canary code is updated whenever the file&rsquo;s hash changes.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>login_function_location</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login/nodejs/node_modules/index.js&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;archive_file&#34;</span> <span class=s2>&#34;login&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>type</span>       = <span class=s2>&#34;zip&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>source_dir</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login/&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>output_path</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login-</span><span class=si>${</span><span class=nb>filemd5</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>login_function_location</span><span class=p>)</span><span class=si>}</span><span class=s2>.zip&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>By incorporating the <code>filemd5</code> function into the configuration of the <code>archive_file</code>, the hash of the file will be calculated each time. If the hash has changed, a new archive will be created, ensuring that the canary code is updated accordingly.</p><h3 id=problem-4-cleanup-issue-with-terraform-destroy>Problem 4: Cleanup Issue with <code>terraform destroy</code><a hidden class=anchor aria-hidden=true href=#problem-4-cleanup-issue-with-terraform-destroy>#</a></h3><p>One significant issue I encountered is related to the cleanup process when executing terraform destroy. Unfortunately, the automatically created lambda function, <code>aws_synthetics_canary</code>, is not removed as expected. I am currently working on finding a solution to address this problem and ensure proper cleanup of resources when destroying the infrastructure.</p><h3 id=update-environment-variables-support>Update: Environment Variables Support<a hidden class=anchor aria-hidden=true href=#update-environment-variables-support>#</a></h3><p>An exciting update regarding the AWS provider! The latest version, 4.5.0, has introduced support for environment_variables. This means you can now leverage this feature by specifying a map of the required environment variables within the run_config block. It provides a more streamlined approach to managing environment variables for your AWS Synthetics canary.</p><p>I hope these improvements provide better clarity and understanding. If you have any additional questions or suggestions, please let me know.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-terraform data-lang=terraform><span class=line><span class=cl><span class=nx>locals</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>canary_variables</span> = <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;app_url&#34;</span> <span class=o>=</span> <span class=s2>&#34;https://mpostument.com&#34;</span>
</span></span><span class=line><span class=cl>  <span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=na>login_function_location</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login/nodejs/node_modules/index.js&#34;</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>data</span> <span class=s2>&#34;archive_file&#34;</span> <span class=s2>&#34;login&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>type</span>       = <span class=s2>&#34;zip&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>source_dir</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login/&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>output_path</span> = <span class=s2>&#34;</span><span class=si>${</span><span class=nx>path</span><span class=p>.</span><span class=nb>module</span><span class=si>}</span><span class=s2>/functions/login-</span><span class=si>${</span><span class=nb>filemd5</span><span class=p>(</span><span class=nx>local</span><span class=p>.</span><span class=nx>login_function_location</span><span class=p>)</span><span class=si>}</span><span class=s2>.zip&#34;</span>
</span></span><span class=line><span class=cl><span class=kr>
</span></span></span><span class=line><span class=cl><span class=kr>resource</span> <span class=s2>&#34;aws_synthetics_canary&#34;</span> <span class=s2>&#34;login&#34;</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>  <span class=na>name</span>                 = <span class=s2>&#34;login_test&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>artifact_s3_location</span> = <span class=s2>&#34;s3://my_canary_bucket/&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>execution_role_arn</span>   = <span class=s2>&#34;role_arn&#34;</span>
</span></span><span class=line><span class=cl>  <span class=na>handler</span>              = <span class=nb>&#34;index</span><span class=p>.</span><span class=nx>handler</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  zip_file             = data.archive_file.login.output_path
</span></span></span><span class=line><span class=cl><span class=s2>  runtime_version      = &#34;</span><span class=nx>syn</span><span class=o>-</span><span class=nx>nodejs</span><span class=o>-</span><span class=nx>puppeteer</span><span class=m>-3</span><span class=p>.</span><span class=m>4</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  start_canary         = true
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  schedule {
</span></span></span><span class=line><span class=cl><span class=s2>    expression = &#34;</span><span class=nx>rate</span><span class=p>(</span><span class=m>5</span> <span class=nx>minutes</span><span class=p>)</span><span class=s2>&#34;
</span></span></span><span class=line><span class=cl><span class=s2>  }
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  run_config {
</span></span></span><span class=line><span class=cl><span class=s2>    timeout_in_seconds    = 300
</span></span></span><span class=line><span class=cl><span class=s2>    environment_variables = local.canary_variables
</span></span></span><span class=line><span class=cl><span class=s2>  }
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>  tags = merge(
</span></span></span><span class=line><span class=cl><span class=s2>    local.common_tags
</span></span></span><span class=line><span class=cl><span class=s2>  )
</span></span></span><span class=line><span class=cl><span class=s2>}
</span></span></span></code></pre></div></div><footer class=post-footer><ul class=post-tags><li><a href=https://mpostument.com/tags/aws/>AWS</a></li><li><a href=https://mpostument.com/tags/devops/>Devops</a></li><li><a href=https://mpostument.com/tags/terraform/>Terraform</a></li><li><a href=https://mpostument.com/tags/automation/>Automation</a></li><li><a href=https://mpostument.com/tags/observability/>Observability</a></li></ul><nav class=paginav><a class=prev href=https://mpostument.com/posts/programming/golang/using-mongo-with-go/><span class=title>« Prev</span><br><span>Using Mongo With Go</span>
</a><a class=next href=https://mpostument.com/posts/programming/golang/using-postgres-with-go/><span class=title>Next »</span><br><span>Using Postgres With Golang</span></a></nav><ul class=share-buttons><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on x" href="https://x.com/intent/tweet/?text=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f&amp;hashtags=AWS%2cDevOps%2cTerraform%2cAutomation%2cObservability"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446C483.971.0 512 28.03 512 62.554zM269.951 190.75 182.567 75.216H56L207.216 272.95 63.9 436.783h61.366L235.9 310.383l96.667 126.4H456L298.367 228.367l134-153.151H371.033zM127.633 110h36.468l219.38 290.065H349.5z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on linkedin" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f&amp;title=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation&amp;summary=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation&amp;source=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM160.461 423.278V197.561h-75.04v225.717h75.04zm270.539.0V293.839c0-69.333-37.018-101.586-86.381-101.586-39.804.0-57.634 21.891-67.617 37.266v-31.958h-75.021c.995 21.181.0 225.717.0 225.717h75.02V297.222c0-6.748.486-13.492 2.474-18.315 5.414-13.475 17.767-27.434 38.494-27.434 27.135.0 38.007 20.707 38.007 51.037v120.768H431zM123.448 88.722C97.774 88.722 81 105.601 81 127.724c0 21.658 16.264 39.002 41.455 39.002h.484c26.165.0 42.452-17.344 42.452-39.002-.485-22.092-16.241-38.954-41.943-39.002z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on reddit" href="https://reddit.com/submit?url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f&title=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zM446 265.638c0-22.964-18.616-41.58-41.58-41.58-11.211.0-21.361 4.457-28.841 11.666-28.424-20.508-67.586-33.757-111.204-35.278l18.941-89.121 61.884 13.157c.756 15.734 13.642 28.29 29.56 28.29 16.407.0 29.706-13.299 29.706-29.701.0-16.403-13.299-29.702-29.706-29.702-11.666.0-21.657 6.792-26.515 16.578l-69.105-14.69c-1.922-.418-3.939-.042-5.585 1.036-1.658 1.073-2.811 2.761-3.224 4.686l-21.152 99.438c-44.258 1.228-84.046 14.494-112.837 35.232-7.468-7.164-17.589-11.591-28.757-11.591-22.965.0-41.585 18.616-41.585 41.58.0 16.896 10.095 31.41 24.568 37.918-.639 4.135-.99 8.328-.99 12.576.0 63.977 74.469 115.836 166.33 115.836s166.334-51.859 166.334-115.836c0-4.218-.347-8.387-.977-12.493 14.564-6.47 24.735-21.034 24.735-38.001zM326.526 373.831c-20.27 20.241-59.115 21.816-70.534 21.816-11.428.0-50.277-1.575-70.522-21.82-3.007-3.008-3.007-7.882.0-10.889 3.003-2.999 7.882-3.003 10.885.0 12.777 12.781 40.11 17.317 59.637 17.317 19.522.0 46.86-4.536 59.657-17.321 3.016-2.999 7.886-2.995 10.885.008 3.008 3.011 3.003 7.882-.008 10.889zm-5.23-48.781c-16.373.0-29.701-13.324-29.701-29.698.0-16.381 13.328-29.714 29.701-29.714 16.378.0 29.706 13.333 29.706 29.714.0 16.374-13.328 29.698-29.706 29.698zM160.91 295.348c0-16.381 13.328-29.71 29.714-29.71 16.369.0 29.689 13.329 29.689 29.71.0 16.373-13.32 29.693-29.689 29.693-16.386.0-29.714-13.32-29.714-29.693z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on facebook" href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H342.978V319.085h66.6l12.672-82.621h-79.272v-53.617c0-22.603 11.073-44.636 46.58-44.636H425.6v-70.34s-32.71-5.582-63.982-5.582c-65.288.0-107.96 39.569-107.96 111.204v62.971h-72.573v82.621h72.573V512h-191.104c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on whatsapp" href="https://api.whatsapp.com/send?text=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation%20-%20https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f"><svg viewBox="0 0 512 512" height="30" width="30" fill="currentcolor"><path d="M449.446.0C483.971.0 512 28.03 512 62.554v386.892C512 483.97 483.97 512 449.446 512H62.554c-34.524.0-62.554-28.03-62.554-62.554V62.554c0-34.524 28.029-62.554 62.554-62.554h386.892zm-58.673 127.703c-33.842-33.881-78.847-52.548-126.798-52.568-98.799.0-179.21 80.405-179.249 179.234-.013 31.593 8.241 62.428 23.927 89.612l-25.429 92.884 95.021-24.925c26.181 14.28 55.659 21.807 85.658 21.816h.074c98.789.0 179.206-80.413 179.247-179.243.018-47.895-18.61-92.93-52.451-126.81zM263.976 403.485h-.06c-26.734-.01-52.954-7.193-75.828-20.767l-5.441-3.229-56.386 14.792 15.05-54.977-3.542-5.637c-14.913-23.72-22.791-51.136-22.779-79.287.033-82.142 66.867-148.971 149.046-148.971 39.793.014 77.199 15.531 105.329 43.692 28.128 28.16 43.609 65.592 43.594 105.4-.034 82.149-66.866 148.983-148.983 148.984zm81.721-111.581c-4.479-2.242-26.499-13.075-30.604-14.571-4.105-1.495-7.091-2.241-10.077 2.241-2.986 4.483-11.569 14.572-14.182 17.562-2.612 2.988-5.225 3.364-9.703 1.12-4.479-2.241-18.91-6.97-36.017-22.23C231.8 264.15 222.81 249.484 220.198 245s-.279-6.908 1.963-9.14c2.016-2.007 4.48-5.232 6.719-7.847 2.24-2.615 2.986-4.484 4.479-7.472 1.493-2.99.747-5.604-.374-7.846-1.119-2.241-10.077-24.288-13.809-33.256-3.635-8.733-7.327-7.55-10.077-7.688-2.609-.13-5.598-.158-8.583-.158-2.986.0-7.839 1.121-11.944 5.604-4.105 4.484-15.675 15.32-15.675 37.364.0 22.046 16.048 43.342 18.287 46.332 2.24 2.99 31.582 48.227 76.511 67.627 10.685 4.615 19.028 7.371 25.533 9.434 10.728 3.41 20.492 2.929 28.209 1.775 8.605-1.285 26.499-10.833 30.231-21.295 3.732-10.464 3.732-19.431 2.612-21.298-1.119-1.869-4.105-2.99-8.583-5.232z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on telegram" href="https://telegram.me/share/url?text=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation&amp;url=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f"><svg viewBox="2 2 28 28" height="30" width="30" fill="currentcolor"><path d="M26.49 29.86H5.5a3.37 3.37.0 01-2.47-1 3.35 3.35.0 01-1-2.47V5.48A3.36 3.36.0 013 3 3.37 3.37.0 015.5 2h21A3.38 3.38.0 0129 3a3.36 3.36.0 011 2.46V26.37a3.35 3.35.0 01-1 2.47 3.38 3.38.0 01-2.51 1.02zm-5.38-6.71a.79.79.0 00.85-.66L24.73 9.24a.55.55.0 00-.18-.46.62.62.0 00-.41-.17q-.08.0-16.53 6.11a.59.59.0 00-.41.59.57.57.0 00.43.52l4 1.24 1.61 4.83a.62.62.0 00.63.43.56.56.0 00.4-.17L16.54 20l4.09 3A.9.9.0 0021.11 23.15zM13.8 20.71l-1.21-4q8.72-5.55 8.78-5.55c.15.0.23.0.23.16a.18.18.0 010 .06s-2.51 2.3-7.52 6.8z"/></svg></a></li><li><a target=_blank rel="noopener noreferrer" aria-label="share AWS Synthetics With Terraform: Overcoming Challenges and Enhancing Automation on ycombinator" href="https://news.ycombinator.com/submitlink?t=AWS%20Synthetics%20With%20Terraform%3a%20Overcoming%20Challenges%20and%20Enhancing%20Automation&u=https%3a%2f%2fmpostument.com%2fposts%2fprogramming%2fterraform%2faws-synthetics-with-terraform%2f"><svg width="30" height="30" viewBox="0 0 512 512" fill="currentcolor" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape"><path d="M449.446.0C483.971.0 512 28.03 512 62.554V449.446C512 483.97 483.97 512 449.446 512H62.554C28.03 512 0 483.97.0 449.446V62.554C0 28.03 28.029.0 62.554.0H449.446zM183.8767 87.9921h-62.034L230.6673 292.4508V424.0079h50.6655V292.4508L390.1575 87.9921H328.1233L256 238.2489z"/></svg></a></li></ul></footer><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//mpostument-com.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></article></main><footer class=footer><span>&copy; 2025 <a href=https://mpostument.com/>Maksym Postument</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>