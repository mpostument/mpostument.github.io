<!doctype html><html prefix="og: http://ogp.me/ns#"><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><title>Build Dotnet Core With Travis &#183; Maksym Postument</title><meta name=description content="Привет!
Сегодня я хочу показать как можно збилдиты и задеплоиты .net core с помощью Travis.
Для начала нужно создать Travis аккаунт. Для этого нужно войти на вашим GitHub аккаунтом. .travis.yml Конфигурация Следующим шагом нужно создать .travis.yml файл в корне репозитория. Пример моего конфигурационного файла:
language:csharpmono:nonedotnet:3.1.4solution:awstaghelper.slninstall:- dotnetrestorescript:- dotnetbuild--configurationRelease--runtimewin-x64--outputwin-x64- dotnetbuild--configurationRelease--runtimewin-x86--outputwin-x86- dotnetbuild--configurationRelease--runtimelinux-x64--outputlinux-x64- dotnetbuild--configurationRelease--runtimeosx-x64--outputosx-x64before_deploy:- zip-r9win-x64.zipwin-x64- zip-r9win-x86.zipwin-x86- zip-r9linux-x64.ziplinux-x64- zip-r9osx-x64.ziposx-x64deploy:provider:releasesapi_key:$api_keyfile:- win-x64.zip- win-x86.zip- linux-x64.zip- osx-x64.zipskip_cleanup:trueon:tags:true.Net Конфигурация Теперь разберем конфиг. Начинается yml с объявления языка программирования language: csharp. Mono стоит none потому что используется ."><meta name=HandheldFriendly content="True"><meta name=MobileOptimized content="320"><meta name=generator content="Hugo 0.74.3"><meta name=robots content="index,follow"><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Build Dotnet Core With Travis"><meta property="og:description" content="Привет!
Сегодня я хочу показать как можно збилдиты и задеплоиты .net core с помощью Travis.
Для начала нужно создать Travis аккаунт. Для этого нужно войти на вашим GitHub аккаунтом. .travis.yml Конфигурация Следующим шагом нужно создать .travis.yml файл в корне репозитория. Пример моего конфигурационного файла:
language:csharpmono:nonedotnet:3.1.4solution:awstaghelper.slninstall:- dotnetrestorescript:- dotnetbuild--configurationRelease--runtimewin-x64--outputwin-x64- dotnetbuild--configurationRelease--runtimewin-x86--outputwin-x86- dotnetbuild--configurationRelease--runtimelinux-x64--outputlinux-x64- dotnetbuild--configurationRelease--runtimeosx-x64--outputosx-x64before_deploy:- zip-r9win-x64.zipwin-x64- zip-r9win-x86.zipwin-x86- zip-r9linux-x64.ziplinux-x64- zip-r9osx-x64.ziposx-x64deploy:provider:releasesapi_key:$api_keyfile:- win-x64.zip- win-x86.zip- linux-x64.zip- osx-x64.zipskip_cleanup:trueon:tags:true.Net Конфигурация Теперь разберем конфиг. Начинается yml с объявления языка программирования language: csharp. Mono стоит none потому что используется ."><meta property="og:type" content="article"><meta property="og:url" content="/ru/2020/08/31/build-dotnet-core-with-travis/"><link rel=stylesheet href=/dist/site.css><link rel=stylesheet href=/dist/syntax.css><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:300italic,400italic,600italic,700italic,400,600,700,300&subset=latin,cyrillic-ext,latin-ext,cyrillic"><link rel=stylesheet href=https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css integrity=sha384-wvfXpqpZZVQGK6TAh5PVlGOfQNHSoD2xbE+QkPxCAFlNEevoEH3Sl0sibVcOQVnN crossorigin=anonymous></head><body><script type=application/javascript>var doNotTrack=false;if(!doNotTrack){(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');ga('create','UA-176839804-1','auto');ga('send','pageview');}</script><div id=wrapper><header class=site-header><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=mpostument.com href=/>mpostument.com</a></h1><a class=button-square href=/index.xml><i class="fa fa-rss"></i></a><a class="button-square button-social hint--top" data-hint=Twitter title=Twitter href=https://twitter.com/Maks_Postument rel=me><i class="fa fa-twitter"></i></a><a class="button-square button-social hint--top" data-hint=Github title=Github href=https://github.com/mpostument rel=me><i class="fa fa-github-alt"></i></a><a class="button-square button-social hint--top" data-hint=Email title=Email href=mailto:777rip777@gmail.com><i class="fa fa-envelope"></i></a></div><ul class=site-nav><li class=site-nav-item><a title=About href=/about/>About</a></li><li class=site-nav-item><a title=Home href=/>Home</a></li><li class=site-nav-item><a title=Projects href=/projects/>Projects</a></li></ul></div></header><div id=container><div class=container><article class=post-container itemscope itemtype=http://schema.org/BlogPosting><header class=post-header><h1 class=post-title itemprop="name headline">Build Dotnet Core With Travis</h1><p class=post-date><span>Published <time datetime=2020-08-31 itemprop=datePublished>Mon, Aug 31, 2020</time></span>
<span>by</span>
<span itemscope itemprop=author itemtype=https://schema.org/Person><span itemprop=name><a href=https://github.com/mpostument itemprop=url rel=author>Maksym Postument</a></span></span></p><p class="post-reading post-line"><span>2 min</span></p></header><nav class=LangNav>Language:
<a href=/2020/08/31/build-dotnet-core-with-travis/>English</a>
<a href=/ua/2020/08/31/build-dotnet-core-with-travis/>Ukrainian</a></nav><div class="post-content clearfix" itemprop=articleBody><img class=post-featured-image src=https://i.imgur.com/MfGG4k8.png><p>Привет!</p><p>Сегодня я хочу показать как можно збилдиты и задеплоиты .net core с помощью <a href=https://travis-ci.com/>Travis</a>.<br>Для начала нужно создать Travis аккаунт. Для этого нужно <a href=https://travis-ci.com/signin>войти на</a> вашим GitHub аккаунтом.
<img src=https://i.imgur.com/L9lOBo8.png alt=Login></p><h2 id=travisyml-конфигурация>.travis.yml Конфигурация</h2><p>Следующим шагом нужно создать .travis.yml файл в корне репозитория.
Пример моего конфигурационного файла:</p><div class=highlight><pre class=chroma><code class=language-yaml data-lang=yaml><span class=k>language</span><span class=p>:</span><span class=w> </span>csharp<span class=w>
</span><span class=w></span><span class=k>mono</span><span class=p>:</span><span class=w> </span>none<span class=w>
</span><span class=w></span><span class=k>dotnet</span><span class=p>:</span><span class=w> </span><span class=m>3.1.4</span><span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>solution</span><span class=p>:</span><span class=w> </span>awstaghelper.sln<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>install</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- dotnet<span class=w> </span>restore<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>script</span><span class=p>:</span><span class=w>
</span><span class=w>  </span>- dotnet<span class=w> </span>build<span class=w> </span>--configuration<span class=w> </span>Release<span class=w> </span>--runtime<span class=w> </span>win-x64<span class=w> </span>--output<span class=w> </span>win-x64<span class=w>
</span><span class=w>  </span>- dotnet<span class=w> </span>build<span class=w> </span>--configuration<span class=w> </span>Release<span class=w> </span>--runtime<span class=w> </span>win-x86<span class=w> </span>--output<span class=w> </span>win-x86<span class=w>
</span><span class=w>  </span>- dotnet<span class=w> </span>build<span class=w> </span>--configuration<span class=w> </span>Release<span class=w> </span>--runtime<span class=w> </span>linux-x64<span class=w> </span>--output<span class=w> </span>linux-x64<span class=w>
</span><span class=w>  </span>- dotnet<span class=w> </span>build<span class=w> </span>--configuration<span class=w> </span>Release<span class=w> </span>--runtime<span class=w> </span>osx-x64<span class=w> </span>--output<span class=w> </span>osx-x64<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>before_deploy</span><span class=p>:</span><span class=w> 
</span><span class=w>  </span>- zip<span class=w> </span>-r9<span class=w> </span>win-x64.zip<span class=w> </span>win-x64<span class=w>
</span><span class=w>  </span>- zip<span class=w> </span>-r9<span class=w> </span>win-x86.zip<span class=w> </span>win-x86<span class=w>
</span><span class=w>  </span>- zip<span class=w> </span>-r9<span class=w> </span>linux-x64.zip<span class=w> </span>linux-x64<span class=w>
</span><span class=w>  </span>- zip<span class=w> </span>-r9<span class=w> </span>osx-x64.zip<span class=w> </span>osx-x64<span class=w>
</span><span class=w>
</span><span class=w></span><span class=k>deploy</span><span class=p>:</span><span class=w>
</span><span class=w>  </span><span class=k>provider</span><span class=p>:</span><span class=w> </span>releases<span class=w>
</span><span class=w>  </span><span class=k>api_key</span><span class=p>:</span><span class=w> </span>$api_key<span class=w>
</span><span class=w>  </span><span class=k>file</span><span class=p>:</span><span class=w> 
</span><span class=w>    </span>- win-x64.zip<span class=w>
</span><span class=w>    </span>- win-x86.zip<span class=w>
</span><span class=w>    </span>- linux-x64.zip<span class=w>
</span><span class=w>    </span>- osx-x64.zip<span class=w>
</span><span class=w>  </span><span class=k>skip_cleanup</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span><span class=w>  </span><span class=k>on</span><span class=p>:</span><span class=w>
</span><span class=w>    </span><span class=k>tags</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=w>
</span></code></pre></div><h2 id=net-конфигурация>.Net Конфигурация</h2><p>Теперь разберем конфиг.
Начинается yml с объявления языка программирования <code>language: csharp</code>. <code>Mono</code> стоит none потому что используется .net core. И последнее это версия .net core. В моем случае это <code>dotnet: 3.1.4</code>. Также необходимо указать название solution <code>solution: awstaghelper.sln</code>.</p><h2 id=build-конфигурация>Build Конфигурация</h2><p>Далее следуют билд шаги. Шаг <code>install</code> используется для установки необходимых зависимостей. <code>Dotnet restore</code> является не обязательным поскольку в последних версиях dotnet <code>restore</code> команда автоматически вызывается при <code>build</code>. Поэтому в этом случае <code>install</code> можно полностью удалить.</p><p>В <code>script</code> секции происходит билд аппликации. Команду <code>build</code> я вызываю 4 раза так делаю билд для различных OS: Windows, Linux, Mac. Операционная система отмечается с помощью <code>--runtime</code> ключа. Список всех runtime можно получить <a href=https://docs.microsoft.com/en-us/dotnet/core/rid-catalog#rid-graph>здесь</a>. <code>--Output</code> ключ указываю в какую директорию положить бинарные файлы.
Также можно добавить ключ <code>/p:PublishSingleFile=true</code> для того чтобы в результате получить только один exe файл. Также этот ключ можно добавить в настройках проекта в Visual Studio.</p><h2 id=deployment-конфигурация>Deployment Конфигурация</h2><p><code>Before_deploy</code> секция вызывается перед Деплой для подготовки binary для релиза. На этом этапе я делаю архив с бинарными файлами которые получил после билд для конжнои операционной системы.</p><p>В <code>deploy</code> секции я использую провайдер <code>releases</code> который делает релиз на github. Список всех провайдеров - <a href=https://docs.travis-ci.com/user/deployment/>docs.travis-ci.com</a>. Для деплоя нужен github token. Сгенерировать его можно на <a href=https://github.com/settings/tokens>GitHub</a>. Далее ключ нужно сохранить в конфигурации travis проекта. Для этого нужно перейти в проект на <a href=https://travis-ci.com/>Travis</a>. Открыть проект/настройки:
<img src=https://i.imgur.com/nHrz23b.png alt=Config>.</p><p>В Environment Variables нужно добавить сгенерированный ключ:
<img src=https://i.imgur.com/wfnfkzi.png alt=Token>
В <code>file</code> нужно указать файлы должны быть задеплоини используя провайдер. <code>Skip_cleanup: true</code> должно быть в <code>true</code> для того чтобы travis не очищал збилджени файлы перед деплоем. <code>On.tags: true</code> значит, что Деплой запускать только на github теги.</p><p>После того как файл готов нужно сделать запушиты изменения в мастер и билд автоматически запустится. Но Деплой не осуществится. Далее на <a href=https://github.com/>GitHub</a> нужно сделать релиз для нужного репозитория. Как только релиз будет сделан билд запустится снова, но на этот раз с деплоем.</p><p>В <a href=https://travis-ci.com/>Travis</a> можно будет увидеть такой результат:
<img src=https://i.imgur.com/02OKZ1R.png alt=Build></p></div><footer class="post-footer clearfix"><p class=post-tags><span>Tagged:</span>
<a href=/ru/tags/travis/>Travis</a>,
<a href=/ru/tags/.net/>.Net</a>,
<a href=/ru/tags/devops/>Devops</a></p><div class=share><a class=icon-twitter href="https://twitter.com/share?text=Build%20Dotnet%20Core%20With%20Travis&url=%2fru%2f2020%2f08%2f31%2fbuild-dotnet-core-with-travis%2f" onclick="window.open(this.href,'twitter-share','width=550,height=235');return false;"><i class="fa fa-twitter"></i><span class=hidden>Twitter</span></a>
<a class=icon-facebook href="https://www.facebook.com/sharer/sharer.php?u=%2fru%2f2020%2f08%2f31%2fbuild-dotnet-core-with-travis%2f" onclick="window.open(this.href,'facebook-share','width=580,height=296');return false;"><i class="fa fa-facebook"></i><span class=hidden>Facebook</span></a>
<a class=icon-google-plus href="https://plus.google.com/share?url=%2fru%2f2020%2f08%2f31%2fbuild-dotnet-core-with-travis%2f" onclick="window.open(this.href,'google-plus-share','width=490,height=530');return false;"><i class="fa fa-google-plus"></i><span class=hidden>Google+</span></a></div></footer></article></div></div></div><footer class=footer><div class=container><div class=site-title-wrapper><h1 class=site-title><a title=mpostument.com href=/>mpostument.com</a></h1><a class="button-square button-jump-top js-jump-top" href=#><i class="fa fa-angle-up"></i></a></div><p class=footer-copyright><span>&copy; 2020 / Powered by <a href=https://gohugo.io/>Hugo</a></span></p><p class=footer-copyright><span><a href=https://github.com/roryg/ghostwriter>Ghostwriter theme</a> By <a href=http://jollygoodthemes.com>JollyGoodThemes</a></span>
<span>/ <a href=https://github.com/jbub/ghostwriter>Ported</a> to Hugo By <a href=https://github.com/jbub>jbub</a></span></p></div></footer><script src=/js/jquery-1.11.3.min.js></script><script src=/js/jquery.fitvids.js></script><script src=/js/scripts.js></script></body></html>